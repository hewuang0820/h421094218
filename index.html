<!DOCTYPE html>
<!-- saved from url=(0023)http://localhost:49625/ -->
<html lang="zh-CN" class="">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公众号文章排版工具</title>
    <!-- 过滤 Tailwind CDN 的生产环境警告 -->
    <script>
      (function(){
        const _warn = console.warn;
        console.warn = function(...args){
          if(typeof args[0]==='string' && args[0].includes('cdn.tailwindcss.com should not be used in production')) return;
          _warn.apply(console, args);
        };
      })();
    </script>
    <script src="./saved_resource"></script>
    <!-- FingerprintJS — 生成跨浏览器稳定机器码 -->
    <script src="https://openfpcdn.io/fingerprintjs/v3"></script>
    <script>
        // 生成并存储全局机器码（大写）
        window.HWA_FP_READY = FingerprintJS.load().then(fp => fp.get()).then(r => {
            const id = r.visitorId.toUpperCase();
            window.HWA_MACHINE_ID = id;
            localStorage.setItem('HWA_MACHINE_ID', id);
            return id;
        });
    </script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#3b82f6',
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                            dark: '#2563eb'
                        },
                        secondary: {
                            DEFAULT: '#10b981',
                            light: '#34d399',
                            dark: '#059669'
                        },
                        accent: {
                            DEFAULT: '#f59e0b',
                            light: '#fbbf24',
                            dark: '#d97706'
                        },
                        rose: {
                            DEFAULT: '#f43f5e',
                            light: '#fb7185',
                            dark: '#e11d48'
                        }
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',
                        'gradient-secondary': 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                        'gradient-card': 'linear-gradient(145deg, #ffffff 0%, #f8fafc 100%)',
                        'gradient-dark': 'linear-gradient(135deg, #1f2937 0%, #111827 100%)',
                        'gradient-accent': 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
                        'gradient-rose': 'linear-gradient(135deg, #f43f5e 0%, #e11d48 100%)',
                        'gradient-hero': 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)',
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'inner-light': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
                        'glow': '0 0 20px rgba(102, 126, 234, 0.4)',
                    },
                    borderRadius: {
                        'xl': '1rem',
                        '2xl': '1.5rem',
                        '3xl': '2rem',
                    }
                }
            }
        }
    </script>
    <script src="./marked.min.js"></script>
    <script>
      // 在使用 marked 之前添加配置
      marked.use({
        extensions: [{
          name: 'strong',
          level: 'inline',
          start(src) {
            return src.match(/\*\*/)?.index;
          },
          tokenizer(src) {
            const match = /^\*\*([^*]*?)\*\*/.exec(src);
            if (match) {
              return {
                type: 'strong',
                raw: match[0],
                text: match[1],
                tokens: this.lexer.inlineTokens(match[1])
              };
            }
            return false;
          },
          renderer(token) {
            return `<strong>${this.parser.parseInline(token.tokens)}</strong>`;
          }
        }]
      });
    </script>
    <link rel="stylesheet" href="./prism-okaidia.min.css">
    <script src="./prism.min.js"></script>
    <script src="./prism-javascript.min.js"></script>
    <script src="./prism-css.min.js"></script>
    <script src="./prism-markdown.min.js"></script>
    <script src="./Sortable.min.js"></script>
    <script src="./jszip.min.js"></script>
    <script src="./FileSaver.min.js"></script>
    <style>
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
        }
        
        /* 深色模式滚动条 */
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        
        /* 卡片悬停动画 */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* 渐变按钮 */
        .btn-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4);
        }
        
        /* 输入框焦点效果 */
        .input-focus {
            transition: all 0.3s ease;
        }
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        
        /* 标签按钮样式 */
        .tab-button {
            position: relative;
            overflow: hidden;
        }
        .tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .tab-button:hover::before {
            left: 100%;
        }
        
        /* 加载动画 */
        .loading-dots {
            display: inline-block;
        }
        .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite step-start;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* 玻璃态效果 */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- 导航栏 -->
    <header class="bg-gradient-hero shadow-xl backdrop-blur-sm relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-black/10 via-transparent to-black/10"></div>
        <div class="container mx-auto px-6 py-6 relative z-10">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-5">
                    <div class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm border border-white/30 shadow-lg">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-white bg-clip-text bg-gradient-to-r from-white to-blue-100">公众号排版工具</h1>
                        <p class="text-white/90 text-sm hidden md:block font-medium">专业级文章排版，让内容更具魅力</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="flex items-center space-x-2 bg-white/10 backdrop-blur-sm rounded-full px-4 py-2 border border-white/20">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-white/90 text-sm font-medium">在线</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="flex-grow p-6">
        <div class="container mx-auto max-w-7xl">
            <div class="flex gap-6">
                <!-- 右侧预览区域 -->
                <div class="flex-1">
                    <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden h-full bg-gradient-to-br from-white to-slate-50/50">
                        <div class="border-b border-gray-200 p-6 bg-gradient-to-r from-purple-50 via-blue-50 to-indigo-50">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-primary rounded-2xl flex items-center justify-center shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                            </div>
                                    <div>
                                        <h2 class="text-2xl font-bold text-gray-800 bg-gradient-to-r from-gray-800 to-purple-600 bg-clip-text text-transparent">实时预览</h2>
                                        <p class="text-sm text-gray-600 font-medium">所见即所得的文章效果</p>
                        </div>
                        </div>
                                <div class="flex gap-3">
                                    <button id="copy-html" class="bg-white text-gray-700 px-5 py-3 rounded-2xl text-sm hover:bg-gray-50 focus:outline-none transition-all duration-300 border border-gray-200 card-hover font-semibold shadow-md hover:shadow-lg">
                                        <div class="flex items-center space-x-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                            </svg>
                                            <span>复制HTML</span>
                    </div>
                                    </button>
                                    <button id="copy-css" class="bg-white text-gray-700 px-5 py-3 rounded-2xl text-sm hover:bg-gray-50 focus:outline-none transition-all duration-300 border border-gray-200 card-hover font-semibold shadow-md hover:shadow-lg">
                                        <div class="flex items-center space-x-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                                            </svg>
                                            <span>复制CSS</span>
                </div>
                                    </button>
                                    <button id="download-html" class="bg-gradient-primary text-white px-5 py-3 rounded-2xl text-sm focus:outline-none transition-all duration-300 font-semibold shadow-lg hover:shadow-xl hover:scale-105">
                                        <div class="flex items-center space-x-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            <span>下载文件</span>
                        </div>
                                    </button>
                                    <button id="copy-wechat" class="bg-gradient-accent text-white px-5 py-3 rounded-2xl text-sm focus:outline-none transition-all duration-300 font-semibold shadow-lg hover:shadow-xl hover:scale-105">
                                        <div class="flex items-center space-x-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                            </svg>
                                            <span>一键复制到公众号</span>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="p-6 h-[calc(100vh-16rem)] overflow-auto bg-gradient-to-br from-gray-25 to-gray-50">
                            <div id="preview-container" class="wechat-article-preview max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6">
                                <div class="text-center py-10 text-gray-500">
                                    <div class="flex flex-col items-center space-y-4">
                                        <svg class="w-16 h-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        <div>
                                            <h3 class="text-lg font-medium text-gray-700 mb-2">开始编辑您的文章</h3>
                                            <p class="text-sm text-gray-500">在右侧输入内容或导入Markdown文件，实时预览将在此显示</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 功能面板区域 -->
                <div class="w-96 flex-shrink-0 space-y-6">
                    <!-- 功能导航卡片 -->
                    <div class="bg-white rounded-3xl shadow-xl p-4 border border-gray-100 bg-gradient-to-br from-white to-blue-50/30">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-8 h-8 bg-gradient-primary rounded-xl flex items-center justify-center shadow-lg">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                        </div>
                            <h2 class="text-lg font-bold text-gray-800 bg-gradient-to-r from-gray-800 to-blue-600 bg-clip-text text-transparent">功能导航</h2>
                            </div>
                        <div class="flex gap-2">
                            <button id="btn-edit" class="tab-button flex-1 bg-gradient-primary text-white px-3 py-2 rounded-lg hover:shadow-lg focus:outline-none transition-all duration-300 text-xs font-semibold shadow-md hover:scale-105">
                                <div class="flex items-center justify-center space-x-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                    <span>编辑</span>
                                </div>
                            </button>
                            <button id="btn-style" class="tab-button flex-1 bg-gradient-to-br from-slate-100 to-slate-200 text-slate-700 px-3 py-2 rounded-lg hover:from-slate-200 hover:to-slate-300 focus:outline-none transition-all duration-300 text-xs font-semibold shadow-md hover:shadow-lg hover:scale-105">
                                <div class="flex items-center justify-center space-x-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                                    </svg>
                                    <span>样式</span>
                                </div>
                            </button>
                            <button id="btn-template" class="tab-button flex-1 bg-gradient-to-br from-slate-100 to-slate-200 text-slate-700 px-3 py-2 rounded-lg hover:from-slate-200 hover:to-slate-300 focus:outline-none transition-all duration-300 text-xs font-semibold shadow-md hover:shadow-lg hover:scale-105">
                                <div class="flex items-center justify-center space-x-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                    <span>模板</span>
                                </div>
                            </button>
                            <button id="btn-batch" class="tab-button flex-1 bg-gradient-to-br from-slate-100 to-slate-200 text-slate-700 px-3 py-2 rounded-lg hover:from-slate-200 hover:to-slate-300 focus:outline-none transition-all duration-300 text-xs font-semibold shadow-md hover:shadow-lg hover:scale-105">
                                <div class="flex items-center justify-center space-x-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                    <span>批量</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- 动态面板区域 -->
                        <div id="panel-container" class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden bg-gradient-to-br from-white to-slate-50/50">
                        <!-- 编辑内容面板 -->
                        <div id="panel-edit" class="panel-content">
                            <div class="border-b border-gray-200 p-6 bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-primary rounded-2xl flex items-center justify-center shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                            </div>
                                <div>
                                        <h2 class="text-xl font-bold text-gray-800 bg-gradient-to-r from-gray-800 to-blue-600 bg-clip-text text-transparent">编辑内容</h2>
                                        <p class="text-sm text-gray-600 font-medium">支持Markdown语法，实时预览</p>
                                </div>
                                </div>
                                </div>
                            <div class="p-6 space-y-6">
                                <div class="space-y-3">
                                    <label for="article-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300">文章标题</label>
                                    <input type="text" id="article-title" class="w-full p-4 border border-gray-200 dark:border-gray-600 rounded-xl input-focus dark:bg-gray-700 text-base placeholder-gray-400 dark:placeholder-gray-500" placeholder="输入您的文章标题...">
                                </div>
                                <div class="space-y-3">
                                    <label for="article-content" class="block text-sm font-medium text-gray-700 dark:text-gray-300">文章内容</label>
                                    <div class="relative">
                                        <textarea id="article-content" class="w-full p-4 border border-gray-200 dark:border-gray-600 rounded-xl input-focus dark:bg-gray-700 text-base placeholder-gray-400 dark:placeholder-gray-500 resize-none" rows="15" placeholder="在此输入Markdown格式的文章内容...&#10;&#10;支持的语法：&#10;# 一级标题&#10;## 二级标题&#10;**粗体** *斜体*&#10;> 引用&#10;- 列表&#10;[链接](url)"></textarea>
                                        <div class="absolute top-4 right-4 text-xs text-gray-400 dark:text-gray-500">
                                            支持Markdown
                                        </div>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <button id="import-md" class="flex-1 bg-gradient-secondary text-white px-4 py-2.5 rounded-xl hover:shadow-lg focus:outline-none transition-all duration-300 card-hover font-medium shadow-md hover:scale-105">
                                        <div class="flex items-center justify-center space-x-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                            </svg>
                                            <span class="text-sm">导入文件</span>
                                        </div>
                                    </button>
                                    <button id="clear-content" class="flex-1 bg-gradient-rose text-white px-4 py-2.5 rounded-xl hover:shadow-lg focus:outline-none transition-all duration-300 card-hover font-medium shadow-md hover:scale-105">
                                        <div class="flex items-center justify-center space-x-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                            <span class="text-sm">清空内容</span>
                                        </div>
                                    </button>
                                </div>
                                <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-700 dark:to-gray-600 p-5 rounded-2xl border border-blue-100 dark:border-gray-600 shadow-lg">
                                    <div class="flex items-center space-x-3 mb-4">
                                        <div class="w-8 h-8 bg-gradient-primary rounded-xl flex items-center justify-center shadow-md">
                                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                            </svg>
                                        </div>
                                        <h3 class="font-bold text-blue-800 dark:text-blue-300 text-lg">字数统计</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl border border-blue-200 dark:border-gray-500 shadow-md hover:shadow-lg transition-shadow">
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1 font-medium">总字数</div>
                                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="word-count">485</div>
                                        </div>
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl border border-blue-200 dark:border-gray-500 shadow-md hover:shadow-lg transition-shadow">
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1 font-medium">中文字数</div>
                                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="chinese-count">451</div>
                                        </div>
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl border border-blue-200 dark:border-gray-500 shadow-md hover:shadow-lg transition-shadow">
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1 font-medium">英文单词</div>
                                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="english-count">34</div>
                                        </div>
                                        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl border border-blue-200 dark:border-gray-500 shadow-md hover:shadow-lg transition-shadow">
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1 font-medium">符号数量</div>
                                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="symbol-count">191</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 样式设置面板 -->
                        <div id="panel-style" class="panel-content hidden">
                            <div class="border-b border-gray-200 p-6 bg-gradient-to-r from-purple-50 to-pink-50">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-primary rounded-2xl flex items-center justify-center shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                                        </svg>
                            </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-gray-800 bg-gradient-to-r from-gray-800 to-purple-600 bg-clip-text text-transparent">样式设置</h2>
                                        <p class="text-sm text-gray-600 font-medium">自定义文章外观样式</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6 space-y-6 max-h-[70vh] overflow-y-auto">
                                <!-- 全局设置 -->
                                <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-5 rounded-2xl border border-gray-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-gray-800">全局设置</h3>
                                    <div class="space-y-5">
                                        <div>
                                            <label class="flex items-center space-x-2">
                                                <input type="checkbox" id="center-content" class="rounded text-primary focus:ring-primary dark:bg-gray-600">
                                                <span>全文居中</span>
                                            </label>
                                        </div>
                                        <div>
                                            <label class="block mb-1">字体</label>
                                            <select id="global-font" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                <optgroup label="系统默认">
                                                    <option value="-apple-system-font, BlinkMacSystemFont, &#39;Helvetica Neue&#39;, &#39;PingFang SC&#39;, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei UI&#39;, &#39;Microsoft YaHei&#39;, Arial, sans-serif">系统默认</option>
                                                </optgroup>
                                                <optgroup label="中文字体">
                                                    <option value="&#39;PingFang SC&#39;, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei&#39;, sans-serif">苹方 + 微软雅黑</option>
                                                    <option value="&#39;Microsoft YaHei&#39;, &#39;SimHei&#39;, sans-serif">微软雅黑</option>
                                                    <option value="&#39;SimSun&#39;, serif">宋体</option>
                                                    <option value="&#39;KaiTi&#39;, serif">楷体</option>
                                                    <option value="&#39;Noto Sans SC&#39;, sans-serif">思源黑体</option>
                                                    <option value="&#39;Noto Serif SC&#39;, serif">思源宋体</option>
                                                    <option value="&#39;OPPO Sans&#39;, &#39;Source Han Sans CN&#39;, sans-serif">OPPO Sans</option>
                                                    <option value="&#39;HarmonyOS Sans SC&#39;, sans-serif">鸿蒙字体</option>
                                                </optgroup>
                                                <optgroup label="西文字体">
                                                    <option value="&#39;Helvetica Neue&#39;, Arial, sans-serif">Helvetica</option>
                                                    <option value="&#39;Arial&#39;, sans-serif">Arial</option>
                                                    <option value="&#39;Times New Roman&#39;, serif">Times New Roman</option>
                                                    <option value="&#39;Georgia&#39;, serif">Georgia</option>
                                                    <option value="&#39;Verdana&#39;, sans-serif">Verdana</option>
                                                    <option value="&#39;Roboto&#39;, sans-serif">Roboto</option>
                                                    <option value="&#39;Open Sans&#39;, sans-serif">Open Sans</option>
                                                </optgroup>
                                                <optgroup label="等宽字体">
                                                    <option value="&#39;Menlo&#39;, &#39;Courier New&#39;, monospace">Menlo</option>
                                                    <option value="&#39;Consolas&#39;, monospace">Consolas</option>
                                                    <option value="&#39;Monaco&#39;, monospace">Monaco</option>
                                                    <option value="&#39;Courier New&#39;, monospace">Courier New</option>
                                                </optgroup>
                                                <optgroup label="手写字体">
                                                    <option value="&#39;Ma Shan Zheng&#39;, cursive">马善政毛笔体</option>
                                                    <option value="&#39;Zhi Mang Xing&#39;, cursive">智勇行书</option>
                                                    <option value="&#39;Long Cang&#39;, cursive">长仓草书</option>
                                                    <option value="&#39;Dancing Script&#39;, cursive">Dancing Script</option>
                                                    <option value="&#39;Pacifico&#39;, cursive">Pacifico</option>
                                                </optgroup>
                                                <optgroup label="艺术字体">
                                                    <option value="&#39;Bungee Shade&#39;, display">Bungee Shade</option>
                                                    <option value="&#39;Bebas Neue&#39;, display">Bebas Neue</option>
                                                    <option value="&#39;Permanent Marker&#39;, display">Permanent Marker</option>
                                                </optgroup>
                                                <option value="custom">自定义...</option>
                                            </select>
                                            <div id="custom-font-container" class="mt-2 hidden">
                                                <input type="text" id="custom-font" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 text-base" placeholder="输入自定义字体名称，用逗号分隔多个字体">
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block mb-1">行间距</label>
                                            <input type="range" id="line-height" min="1" max="3" step="0.1" value="1.75" class="w-full">
                                            <div class="flex justify-between text-sm">
                                                <span>紧凑</span>
                                                <span id="line-height-value">1.75</span>
                                                <span>宽松</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block mb-1">字间距</label>
                                            <input type="range" id="letter-spacing" min="0" max="0.5" step="0.05" value="0.05" class="w-full">
                                            <div class="flex justify-between text-sm">
                                                <span>紧凑</span>
                                                <span id="letter-spacing-value">0.05em</span>
                                                <span>宽松</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 正文样式 -->
                                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-5 rounded-2xl border border-blue-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-blue-800">正文样式</h3>
                                    <div class="space-y-5">
                                        <div>
                                            <label class="block mb-1">字体大小</label>
                                            <input type="range" id="p-font-size" min="12" max="24" step="1" value="16" class="w-full">
                                            <div class="flex justify-between text-sm">
                                                <span>小</span>
                                                <span id="p-font-size-value">16px</span>
                                                <span>大</span>
                                            </div>
                                        </div>
                                        
                                        <!-- 段落颜色设置 -->
                                        <div>
                                            <label class="flex items-center mb-1">
                                                <span>文本颜色</span>
                                                <div class="ml-2">
                                                    <select id="p-color-mode" class="text-sm p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                        <option value="single">单色</option>
                                                        <option value="multiple">多色轮换</option>
                                                        <option value="random">随机颜色</option>
                                                    </select>
                                                </div>
                                            </label>
                                            
                                            <!-- 单色模式 -->
                                            <div id="p-color-single" class="p-color-group">
                                                <div class="flex gap-2">
                                                    <input type="color" id="p-color" value="#000000" class="w-8 h-8 rounded-md">
                                                    <input type="text" id="p-color-hex" value="#000000" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                    <button id="random-p-color" class="bg-primary text-white px-2 rounded-md hover:bg-primary-dark focus:outline-none">随机</button>
                                                </div>
                                            </div>
                                            
                                            <!-- 多色轮换模式 -->
                                            <div id="p-color-multiple" class="p-color-group hidden">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <span class="text-sm">轮换颜色:</span>
                                                    <button id="add-p-color" class="bg-green-600 text-white px-2 py-1 rounded-md text-sm hover:bg-green-700 focus:outline-none">添加颜色</button>
                                                </div>
                                                <div id="p-colors-list" class="space-y-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                    <!-- 颜色列表将动态添加 -->
                                                </div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                    拖动可以调整颜色顺序
                                                </div>
                                            </div>
                                            
                                            <!-- 随机颜色模式 -->
                                            <div id="p-color-random" class="p-color-group hidden">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <span class="text-sm">随机颜色数量:</span>
                                                    <input type="number" id="p-random-count" min="2" max="10" value="3" class="w-16 p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                    <button id="generate-p-random" class="bg-primary text-white px-2 py-1 rounded-md text-sm hover:bg-primary-dark focus:outline-none">生成</button>
                                                </div>
                                                <div id="p-random-colors" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                    <!-- 随机颜色将动态添加 -->
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="block mb-1">段落间距</label>
                                            <input type="range" id="p-margin" min="0.5" max="2.5" step="0.1" value="1" class="w-full">
                                            <div class="flex justify-between text-sm">
                                                <span>紧凑</span>
                                                <span id="p-margin-value">1em</span>
                                                <span>宽松</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 标题样式 -->
                                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-5 rounded-2xl border border-purple-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-purple-800">标题样式</h3>
                                    <div class="space-y-5">
                                        <!-- 标题选择 -->
                                        <div class="flex gap-2">
                                            <button data-heading="h1" class="heading-select bg-primary text-white px-3 py-1 rounded-md text-sm">H1</button>
                                            <button data-heading="h2" class="heading-select bg-gray-200 dark:bg-gray-600 px-3 py-1 rounded-md text-sm">H2</button>
                                            <button data-heading="h3" class="heading-select bg-gray-200 dark:bg-gray-600 px-3 py-1 rounded-md text-sm">H3</button>
                                        </div>
                                        
                                        <!-- H1设置 -->
                                        <div id="h1-settings" class="heading-settings">
                                            <div class="flex justify-between mb-2">
                                                <span class="text-sm">使用模板:</span>
                                                <div class="flex gap-1">
                                                    <button id="h1-template-import" class="bg-blue-600 text-white px-2 py-1 rounded-md text-xs hover:bg-blue-700 focus:outline-none">导入模板</button>
                                                    <button id="h1-template-clear" class="bg-gray-600 text-white px-2 py-1 rounded-md text-xs hover:bg-gray-700 focus:outline-none">清除模板</button>
                                                </div>
                                            </div>
                                            <div id="h1-template-info" class="text-xs text-gray-500 dark:text-gray-400 mb-2 hidden">
                                                已使用模板: <span id="h1-template-name">未设置</span>
                                            </div>
                                            <div id="h1-standard-settings">
                                                <div>
                                                    <label class="block mb-1">字体大小</label>
                                                    <input type="range" id="h1-font-size" min="18" max="36" step="1" value="24" class="w-full">
                                                    <div class="flex justify-between text-sm">
                                                        <span>小</span>
                                                        <span id="h1-font-size-value">24px</span>
                                                        <span>大</span>
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <label class="block mb-1">文本颜色</label>
                                                    <div class="flex gap-2">
                                                        <input type="color" id="h1-color" value="#000000" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="h1-color-hex" value="#000000" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <label class="block mb-1">背景颜色</label>
                                                    <div class="flex gap-2">
                                                        <input type="color" id="h1-bg-color" value="#ffffff" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="h1-bg-color-hex" value="#ffffff" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <label class="flex items-center space-x-2">
                                                        <input type="checkbox" id="h1-border" class="rounded text-primary focus:ring-primary dark:bg-gray-600" checked="">
                                                        <span>显示下边框</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- H2设置 -->
                                        <div id="h2-settings" class="heading-settings hidden">
                                            <div class="flex justify-between mb-2">
                                                <span class="text-sm">使用模板:</span>
                                                <div class="flex gap-1">
                                                    <button id="h2-template-import" class="bg-blue-600 text-white px-2 py-1 rounded-md text-xs hover:bg-blue-700 focus:outline-none">导入模板</button>
                                                    <button id="h2-template-clear" class="bg-gray-600 text-white px-2 py-1 rounded-md text-xs hover:bg-gray-700 focus:outline-none">清除模板</button>
                                                </div>
                                            </div>
                                            <div id="h2-template-info" class="text-xs text-gray-500 dark:text-gray-400 mb-2 hidden">
                                                已使用模板: <span id="h2-template-name">未设置</span>
                                            </div>
                                            <div id="h2-standard-settings">
                                                <div>
                                                    <label class="block mb-1">字体大小</label>
                                                    <input type="range" id="h2-font-size" min="16" max="30" step="1" value="20" class="w-full">
                                                    <div class="flex justify-between text-sm">
                                                        <span>小</span>
                                                        <span id="h2-font-size-value">20px</span>
                                                        <span>大</span>
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <label class="block mb-1">文本颜色</label>
                                                    <div class="flex gap-2">
                                                        <input type="color" id="h2-color" value="#000000" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="h2-color-hex" value="#000000" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <label class="block mb-1">左侧边框颜色</label>
                                                    <div class="flex gap-2">
                                                        <input type="color" id="h2-border-color" value="#5D5CDE" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="h2-border-color-hex" value="#5D5CDE" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- H3设置 -->
                                        <div id="h3-settings" class="heading-settings hidden">
                                            <div class="flex justify-between mb-2">
                                                <span class="text-sm">使用模板:</span>
                                                <div class="flex gap-1">
                                                    <button id="h3-template-import" class="bg-blue-600 text-white px-2 py-1 rounded-md text-xs hover:bg-blue-700 focus:outline-none">导入模板</button>
                                                    <button id="h3-template-clear" class="bg-gray-600 text-white px-2 py-1 rounded-md text-xs hover:bg-gray-700 focus:outline-none">清除模板</button>
                                                </div>
                                            </div>
                                            <div id="h3-template-info" class="text-xs text-gray-500 dark:text-gray-400 mb-2 hidden">
                                                已使用模板: <span id="h3-template-name">未设置</span>
                                            </div>
                                            <div id="h3-standard-settings">
                                                <div>
                                                    <label class="block mb-1">字体大小</label>
                                                    <input type="range" id="h3-font-size" min="14" max="24" step="1" value="18" class="w-full">
                                                    <div class="flex justify-between text-sm">
                                                        <span>小</span>
                                                        <span id="h3-font-size-value">18px</span>
                                                        <span>大</span>
                                                    </div>
                                                </div>
                                                <div class="mt-3">
                                                    <label class="block mb-1">文本颜色</label>
                                                    <div class="flex gap-2">
                                                        <input type="color" id="h3-color" value="#000000" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="h3-color-hex" value="#000000" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 强调样式 -->
                                <div class="bg-gradient-to-br from-green-50 to-green-100 p-5 rounded-2xl border border-green-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-green-800">强调样式</h3>
                                    <div class="space-y-5">
                                        <!-- 强调类型选择 -->
                                        <div class="flex gap-2">
                                            <button data-emphasis="strong" class="emphasis-select bg-primary text-white px-3 py-1 rounded-md text-sm">粗体</button>
                                            <button data-emphasis="em" class="emphasis-select bg-gray-200 dark:bg-gray-600 px-3 py-1 rounded-md text-sm">斜体</button>
                                            <button data-emphasis="blockquote" class="emphasis-select bg-gray-200 dark:bg-gray-600 px-3 py-1 rounded-md text-sm">引用</button>
                                            <button data-emphasis="list" class="emphasis-select bg-gray-200 dark:bg-gray-600 px-3 py-1 rounded-md text-sm">列表</button>
                                        </div>
                                        
                                        <!-- 粗体设置 -->
                                        <div id="strong-settings" class="emphasis-settings">
                                            <div>
                                                <label class="flex items-center mb-1">
                                                    <span>文本颜色</span>
                                                    <div class="ml-2">
                                                        <select id="strong-color-mode" class="text-sm p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                            <option value="single">单色</option>
                                                            <option value="multiple">多色轮换</option>
                                                            <option value="random">随机颜色</option>
                                                        </select>
                                                    </div>
                                                </label>
                                                
                                                <!-- 单色模式 -->
                                                <div id="strong-color-single" class="strong-color-group">
                                                    <div class="flex gap-2">
                                                        <input type="color" id="strong-color" value="#5D5CDE" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="strong-color-hex" value="#5D5CDE" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                        <button id="random-strong-color" class="bg-primary text-white px-2 rounded-md hover:bg-primary-dark focus:outline-none">随机</button>
                                                    </div>
                                                </div>
                                                
                                                <!-- 多色轮换模式 -->
                                                <div id="strong-color-multiple" class="strong-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">轮换颜色:</span>
                                                        <button id="add-strong-color" class="bg-green-600 text-white px-2 py-1 rounded-md text-sm hover:bg-green-700 focus:outline-none">添加颜色</button>
                                                    </div>
                                                    <div id="strong-colors-list" class="space-y-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 颜色列表将动态添加 -->
                                                    </div>
                                                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                        拖动可以调整颜色顺序
                                                    </div>
                                                </div>
                                                
                                                <!-- 随机颜色模式 -->
                                                <div id="strong-color-random" class="strong-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">随机颜色数量:</span>
                                                        <input type="number" id="strong-random-count" min="2" max="10" value="3" class="w-16 p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                        <button id="generate-strong-random" class="bg-primary text-white px-2 py-1 rounded-md text-sm hover:bg-primary-dark focus:outline-none">生成</button>
                                                    </div>
                                                    <div id="strong-random-colors" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 随机颜色将动态添加 -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <label class="block mb-1">背景颜色</label>
                                                <div class="flex gap-2">
                                                    <input type="color" id="strong-bg-color" value="#f0f0f0" class="w-8 h-8 rounded-md">
                                                    <input type="text" id="strong-bg-color-hex" value="#f0f0f0" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <label class="flex items-center space-x-2">
                                                    <input type="checkbox" id="strong-underline" class="rounded text-primary focus:ring-primary dark:bg-gray-600">
                                                    <span>添加下划线</span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- 斜体设置 -->
                                        <div id="em-settings" class="emphasis-settings hidden">
                                            <div>
                                                <label class="flex items-center mb-1">
                                                    <span>文本颜色</span>
                                                    <div class="ml-2">
                                                        <select id="em-color-mode" class="text-sm p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                            <option value="single">单色</option>
                                                            <option value="multiple">多色轮换</option>
                                                            <option value="random">随机颜色</option>
                                                        </select>
                                                    </div>
                                                </label>
                                                
                                                <!-- 单色模式 -->
                                                <div id="em-color-single" class="em-color-group">
                                                    <div class="flex gap-2">
                                                        <input type="color" id="em-color" value="#888888" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="em-color-hex" value="#888888" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                        <button id="random-em-color" class="bg-primary text-white px-2 rounded-md hover:bg-primary-dark focus:outline-none">随机</button>
                                                    </div>
                                                </div>
                                                
                                                <!-- 多色轮换模式 -->
                                                <div id="em-color-multiple" class="em-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">轮换颜色:</span>
                                                        <button id="add-em-color" class="bg-green-600 text-white px-2 py-1 rounded-md text-sm hover:bg-green-700 focus:outline-none">添加颜色</button>
                                                    </div>
                                                    <div id="em-colors-list" class="space-y-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 颜色列表将动态添加 -->
                                                    </div>
                                                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                        拖动可以调整颜色顺序
                                                    </div>
                                                </div>
                                                
                                                <!-- 随机颜色模式 -->
                                                <div id="em-color-random" class="em-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">随机颜色数量:</span>
                                                        <input type="number" id="em-random-count" min="2" max="10" value="3" class="w-16 p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                        <button id="generate-em-random" class="bg-primary text-white px-2 py-1 rounded-md text-sm hover:bg-primary-dark focus:outline-none">生成</button>
                                                    </div>
                                                    <div id="em-random-colors" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 随机颜色将动态添加 -->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <label class="flex items-center space-x-2">
                                                    <input type="checkbox" id="em-keep-italic" class="rounded text-primary focus:ring-primary dark:bg-gray-600" checked="">
                                                    <span>保持斜体</span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- 引用设置 -->
                                        <div id="blockquote-settings" class="emphasis-settings hidden">
                                            <div>
                                                <label class="flex items-center mb-1">
                                                    <span>文本颜色</span>
                                                    <div class="ml-2">
                                                        <select id="blockquote-color-mode" class="text-sm p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                            <option value="single">单色</option>
                                                            <option value="multiple">多色轮换</option>
                                                            <option value="random">随机颜色</option>
                                                        </select>
                                                    </div>
                                                </label>
                                                
                                                <!-- 单色模式 -->
                                                <div id="blockquote-color-single" class="blockquote-color-group">
                                                    <div class="flex gap-2">
                                                        <input type="color" id="blockquote-color" value="#666666" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="blockquote-color-hex" value="#666666" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                        <button id="random-blockquote-color" class="bg-primary text-white px-2 rounded-md hover:bg-primary-dark focus:outline-none">随机</button>
                                                    </div>
                                                </div>
                                                
                                                <!-- 多色轮换模式 -->
                                                <div id="blockquote-color-multiple" class="blockquote-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">轮换颜色:</span>
                                                        <button id="add-blockquote-color" class="bg-green-600 text-white px-2 py-1 rounded-md text-sm hover:bg-green-700 focus:outline-none">添加颜色</button>
                                                    </div>
                                                    <div id="blockquote-colors-list" class="space-y-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 颜色列表将动态添加 -->
                                                    </div>
                                                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                        拖动可以调整颜色顺序
                                                    </div>
                                                </div>
                                                
                                                <!-- 随机颜色模式 -->
                                                <div id="blockquote-color-random" class="blockquote-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">随机颜色数量:</span>
                                                        <input type="number" id="blockquote-random-count" min="2" max="10" value="3" class="w-16 p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                        <button id="generate-blockquote-random" class="bg-primary text-white px-2 py-1 rounded-md text-sm hover:bg-primary-dark focus:outline-none">生成</button>
                                                    </div>
                                                    <div id="blockquote-random-colors" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 随机颜色将动态添加 -->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <label class="block mb-1">背景颜色</label>
                                                <div class="flex gap-2">
                                                    <input type="color" id="blockquote-bg-color" value="#f5f5f5" class="w-8 h-8 rounded-md">
                                                    <input type="text" id="blockquote-bg-color-hex" value="#f5f5f5" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <label class="block mb-1">左边框颜色</label>
                                                <div class="flex gap-2">
                                                    <input type="color" id="blockquote-border-color" value="#dddddd" class="w-8 h-8 rounded-md">
                                                    <input type="text" id="blockquote-border-color-hex" value="#dddddd" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 列表设置 -->
                                        <div id="list-settings" class="emphasis-settings hidden">
                                            <div>
                                                <label class="flex items-center mb-1">
                                                    <span>文本颜色</span>
                                                    <div class="ml-2">
                                                        <select id="list-color-mode" class="text-sm p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                            <option value="single">单色</option>
                                                            <option value="multiple">多色轮换</option>
                                                            <option value="random">随机颜色</option>
                                                        </select>
                                                    </div>
                                                </label>
                                                
                                                <!-- 单色模式 -->
                                                <div id="list-color-single" class="list-color-group">
                                                    <div class="flex gap-2">
                                                        <input type="color" id="list-color" value="#000000" class="w-8 h-8 rounded-md">
                                                        <input type="text" id="list-color-hex" value="#000000" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                        <button id="random-list-color" class="bg-primary text-white px-2 rounded-md hover:bg-primary-dark focus:outline-none">随机</button>
                                                    </div>
                                                </div>
                                                
                                                <!-- 多色轮换模式 -->
                                                <div id="list-color-multiple" class="list-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">轮换颜色:</span>
                                                        <button id="add-list-color" class="bg-green-600 text-white px-2 py-1 rounded-md text-sm hover:bg-green-700 focus:outline-none">添加颜色</button>
                                                    </div>
                                                    <div id="list-colors-list" class="space-y-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 颜色列表将动态添加 -->
                                                    </div>
                                                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                                        拖动可以调整颜色顺序
                                                    </div>
                                                </div>
                                                
                                                <!-- 随机颜色模式 -->
                                                <div id="list-color-random" class="list-color-group hidden">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-sm">随机颜色数量:</span>
                                                        <input type="number" id="list-random-count" min="2" max="10" value="3" class="w-16 p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                        <button id="generate-list-random" class="bg-primary text-white px-2 py-1 rounded-md text-sm hover:bg-primary-dark focus:outline-none">生成</button>
                                                    </div>
                                                    <div id="list-random-colors" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto border dark:border-gray-600 rounded-md p-2">
                                                        <!-- 随机颜色将动态添加 -->
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <label class="block mb-1">项目符号/数字颜色</label>
                                                <div class="flex gap-2">
                                                    <input type="color" id="list-marker-color" value="#666666" class="w-8 h-8 rounded-md">
                                                    <input type="text" id="list-marker-color-hex" value="#666666" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <label class="flex items-center space-x-2">
                                                    <input type="checkbox" id="list-bold" class="rounded text-primary focus:ring-primary dark:bg-gray-600">
                                                    <span>加粗显示</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 文章顶部和底部模板 -->
                                <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-5 rounded-2xl border border-orange-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-orange-800">文章模板</h3>
                                    <div class="space-y-5">
                                        <!-- 顶部模板 -->
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-sm">顶部模板:</span>
                                                <div class="flex gap-1">
                                                    <button id="top-template-import" class="bg-blue-600 text-white px-2 py-1 rounded-md text-xs hover:bg-blue-700 focus:outline-none">导入模板</button>
                                                    <button id="top-template-clear" class="bg-gray-600 text-white px-2 py-1 rounded-md text-xs hover:bg-gray-700 focus:outline-none">清除模板</button>
                                                </div>
                                            </div>
                                            <div id="top-template-info" class="text-xs text-gray-500 dark:text-gray-400 mb-1 hidden">
                                                已使用模板: <span id="top-template-name">未设置</span>
                                            </div>
                                            <div id="top-template-preview" class="max-h-20 overflow-y-auto border dark:border-gray-600 rounded-md p-2 text-xs bg-gray-100 dark:bg-gray-600 hidden">
                                                <!-- 模板预览将显示在这里 -->
                                            </div>
                                        </div>
                                        
                                        <!-- 底部模板 -->
                                        <div>
                                            <div class="flex justify-between mb-1">
                                                <span class="text-sm">底部模板:</span>
                                                <div class="flex gap-1">
                                                    <button id="bottom-template-import" class="bg-blue-600 text-white px-2 py-1 rounded-md text-xs hover:bg-blue-700 focus:outline-none">导入模板</button>
                                                    <button id="bottom-template-clear" class="bg-gray-600 text-white px-2 py-1 rounded-md text-xs hover:bg-gray-700 focus:outline-none">清除模板</button>
                                                </div>
                                            </div>
                                            <div id="bottom-template-info" class="text-xs text-gray-500 dark:text-gray-400 mb-1">
                                                已使用模板: <span id="bottom-template-name">标准底部</span>
                                            </div>
                                            <div id="bottom-template-preview" class="max-h-20 overflow-y-auto border dark:border-gray-600 rounded-md p-2 text-xs bg-gray-100 dark:bg-gray-600">点分享<br>点收藏<br>点在看<br>点点赞</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 代码样式 -->
                                <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 p-5 rounded-2xl border border-indigo-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-indigo-800">代码样式</h3>
                                    <div class="space-y-5">
                                        <div>
                                            <label class="block mb-1">行内代码</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-sm mb-1">文本颜色</label>
                                                    <input type="color" id="code-color" value="#E83E8C" class="w-full rounded-md">
                                                </div>
                                                <div>
                                                    <label class="block text-sm mb-1">背景颜色</label>
                                                    <input type="color" id="code-bg-color" value="#f5f5f5" class="w-full rounded-md">
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block mb-1">代码块主题</label>
                                            <select id="code-block-theme" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                <option value="okaidia">Okaidia (深色)</option>
                                                <option value="prism">Prism (浅色)</option>
                                                <option value="tomorrow">Tomorrow Night</option>
                                                <option value="coy">Coy</option>
                                                <option value="solarizedlight">Solarized Light</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- 其他元素样式 -->
                                <div class="bg-gradient-to-br from-pink-50 to-pink-100 p-5 rounded-2xl border border-pink-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-pink-800">其他元素</h3>
                                    <div class="space-y-5">
                                        <div>
                                            <label class="block mb-1">链接颜色</label>
                                            <div class="flex gap-2">
                                                <input type="color" id="link-color" value="#5D5CDE" class="w-8 h-8 rounded-md">
                                                <input type="text" id="link-color-hex" value="#5D5CDE" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block mb-1">分割线样式</label>
                                            <select id="hr-style" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                                <option value="solid">实线</option>
                                                <option value="dashed">虚线</option>
                                                <option value="dotted">点线</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block mb-1">分割线颜色</label>
                                            <div class="flex gap-2">
                                                <input type="color" id="hr-color" value="#eeeeee" class="w-8 h-8 rounded-md">
                                                <input type="text" id="hr-color-hex" value="#eeeeee" class="flex-grow p-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-600 dark:border-gray-500 text-base">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 操作按钮 -->
                                <div class="flex justify-between mt-6 pt-4 border-t border-gray-200">
                                    <button id="reset-styles" class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-2xl hover:from-red-600 hover:to-red-700 focus:outline-none transition-all duration-300 font-semibold shadow-lg hover:shadow-xl hover:scale-105">重置样式</button>
                                    <button id="apply-styles" class="bg-gradient-primary text-white px-6 py-3 rounded-2xl focus:outline-none transition-all duration-300 font-semibold shadow-lg hover:shadow-xl hover:scale-105">应用样式</button>
                                </div>
                            </div>
                        </div>

                        <!-- 模板管理面板 -->
                        <div id="panel-template" class="panel-content hidden">
                            <div class="border-b border-gray-200 p-6 bg-gradient-to-r from-orange-50 via-yellow-50 to-orange-50">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                            </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-gray-800 bg-gradient-to-r from-gray-800 to-orange-600 bg-clip-text text-transparent">模板管理</h2>
                                        <p class="text-sm text-gray-600 font-medium">保存和管理样式模板</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6 space-y-6">
                                <!-- 浏览模板库 -->
                                <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-5 rounded-2xl border border-yellow-200 shadow-sm">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-bold text-lg text-yellow-800">我的模板库</h3>
                                        <div class="flex gap-2">
                                            <select id="template-filter" class="text-sm p-1 border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                <option value="all">全部模板</option>
                                                <option value="custom">自定义模板</option>
                                                <option value="built-in">内置模板</option>
                                            </select>
                                            <button id="export-templates" class="bg-green-500 p-1 rounded-md hover:bg-green-600 text-white" title="导出模板库">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                                </svg>
                                            </button>
                                            <button id="import-templates" class="bg-blue-500 p-1 rounded-md hover:bg-blue-600 text-white" title="导入模板库">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                                </svg>
                                            </button>
                                            <button id="refresh-templates" class="bg-gray-200 dark:bg-gray-600 p-1 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="template-list" class="grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-[400px] overflow-y-auto p-1"><div class="bg-white dark:bg-gray-700 p-3 rounded-md border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow duration-200 border-l-4 border-l-primary">
                        <div class="flex flex-col space-y-2">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-medium text-lg">深色专业</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        <span class="bg-primary text-white px-1 py-0.5 rounded text-xs mr-1">内置</span>
                                        2025-03-23 22:58
                                    </div>
                                </div>
                                <div class="flex gap-1">
                                    <button class="apply-template bg-primary text-white p-1 rounded-md text-sm hover:bg-primary-dark" title="应用此模板" data-name="深色专业">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </button>
                                    
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-300">深色背景的专业风格排版</p>
                            <div class="flex flex-wrap gap-1 mt-1">
                                <div class="w-5 h-5 rounded-full" style="background-color: #1a73e8" title="标题颜色"></div>
                                <div class="w-5 h-5 rounded-full" style="background-color: #0d5bdd" title="强调颜色"></div>
                                <div class="w-5 h-5 rounded-full" style="background-color: #333333" title="段落颜色"></div>
                            </div>
                        </div>
                    </div><div class="bg-white dark:bg-gray-700 p-3 rounded-md border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow duration-200 border-l-4 border-l-primary">
                        <div class="flex flex-col space-y-2">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-medium text-lg">多彩活泼</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        <span class="bg-primary text-white px-1 py-0.5 rounded text-xs mr-1">内置</span>
                                        2025-03-23 22:58
                                    </div>
                                </div>
                                <div class="flex gap-1">
                                    <button class="apply-template bg-primary text-white p-1 rounded-md text-sm hover:bg-primary-dark" title="应用此模板" data-name="多彩活泼">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </button>
                                    
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-300">彩色活泼的风格，适合轻松愉快的文章</p>
                            <div class="flex flex-wrap gap-1 mt-1">
                                <div class="w-5 h-5 rounded-full" style="background-color: #e74c3c" title="标题颜色"></div>
                                <div class="w-5 h-5 rounded-full" style="background-color: #e74c3c" title="强调颜色"></div>
                                <div class="w-5 h-5 rounded-full" style="background-color: #e74c3c" title="段落颜色"></div><div class="w-5 h-5 rounded-full" style="background-color: #3498db" title="段落颜色"></div><div class="w-5 h-5 rounded-full" style="background-color: #2ecc71" title="段落颜色"></div><div class="w-5 h-5 rounded-full" style="background-color: #f39c12" title="段落颜色"></div><div class="w-5 h-5 rounded-full" style="background-color: #9b59b6" title="段落颜色"></div>
                            </div>
                        </div>
                    </div><div class="bg-white dark:bg-gray-700 p-3 rounded-md border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow duration-200 border-l-4 border-l-primary">
                        <div class="flex flex-col space-y-2">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-medium text-lg">优雅简约</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        <span class="bg-primary text-white px-1 py-0.5 rounded text-xs mr-1">内置</span>
                                        2025-03-23 22:58
                                    </div>
                                </div>
                                <div class="flex gap-1">
                                    <button class="apply-template bg-primary text-white p-1 rounded-md text-sm hover:bg-primary-dark" title="应用此模板" data-name="优雅简约">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </button>
                                    
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-300">简约优雅的风格，适合文学和思考类文章</p>
                            <div class="flex flex-wrap gap-1 mt-1">
                                <div class="w-5 h-5 rounded-full" style="background-color: #2c3e50" title="标题颜色"></div>
                                <div class="w-5 h-5 rounded-full" style="background-color: #2c3e50" title="强调颜色"></div>
                                <div class="w-5 h-5 rounded-full" style="background-color: #3c3c3c" title="段落颜色"></div>
                            </div>
                        </div>
                                                        </div></div>
                                </div>

                                <!-- 保存当前模板 -->
                                <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-5 rounded-2xl border border-orange-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-orange-800">保存当前样式</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label for="template-name" class="block mb-2 font-medium">模板名称</label>
                                            <input type="text" id="template-name" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 text-base" placeholder="输入模板名称">
                                        </div>
                                        <div>
                                            <label for="template-desc" class="block mb-2 font-medium">模板描述 (可选)</label>
                                            <textarea id="template-desc" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 text-base" rows="2" placeholder="简要描述此模板的用途或特点"></textarea>
                                        </div>
                                        <div class="flex justify-end">
                                            <button id="save-template" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-dark focus:outline-none">保存模板</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 批量处理面板 -->
                        <div id="panel-batch" class="panel-content hidden">
                            <div class="border-b border-gray-200 p-6 bg-gradient-to-r from-cyan-50 via-blue-50 to-cyan-50">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-2xl flex items-center justify-center shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                            </div>
                                    <div>
                                        <h2 class="text-xl font-bold text-gray-800 bg-gradient-to-r from-gray-800 to-cyan-600 bg-clip-text text-transparent">批量处理</h2>
                                        <p class="text-sm text-gray-600 font-medium">批量处理多个文件</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-6 space-y-6">
                                <div class="bg-gradient-to-br from-cyan-50 to-cyan-100 p-5 rounded-2xl border border-cyan-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-cyan-800">选择文件或文件夹</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block mb-2">处理方式</label>
                                            <div class="space-y-2">
                                                <label class="flex items-center space-x-2">
                                                    <input type="radio" name="batch-mode" value="folder" class="text-primary focus:ring-primary dark:bg-gray-600" checked="">
                                                    <span>选择文件夹</span>
                                                </label>
                                                <label class="flex items-center space-x-2">
                                                    <input type="radio" name="batch-mode" value="files" class="text-primary focus:ring-primary dark:bg-gray-600">
                                                    <span>选择多个文件</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button id="select-files-btn" class="bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-dark focus:outline-none flex-1">选择文件</button>
                                        </div>
                                        <div id="selected-files-info" class="text-sm text-gray-500 dark:text-gray-400 hidden">
                                            已选择: <span id="selected-files-count">0</span> 个文件
                                        </div>
                                        <div id="file-debug-info" class="text-xs text-gray-500 dark:text-gray-400 mt-2 hidden overflow-auto max-h-28 border p-1 rounded">
                                            <!-- 文件调试信息 -->
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-5 rounded-2xl border border-blue-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-blue-800">应用模板</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block mb-2">模板应用方式</label>
                                            <div class="space-y-2">
                                                <label class="flex items-center space-x-2">
                                                    <input type="radio" name="template-apply-mode" value="single" class="text-primary focus:ring-primary dark:bg-gray-600" checked="">
                                                    <span>使用单一模板</span>
                                                </label>
                                                <label class="flex items-center space-x-2">
                                                    <input type="radio" name="template-apply-mode" value="random" class="text-primary focus:ring-primary dark:bg-gray-600">
                                                    <span>随机应用多个模板</span>
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- 单一模板选择 -->
                                        <div id="single-template-select">
                                            <label for="batch-template" class="block mb-2">选择模板</label>
                                            <select id="batch-template" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 text-base"><option value="">使用当前样式</option><option value="深色专业">深色专业</option><option value="多彩活泼">多彩活泼</option><option value="优雅简约">优雅简约</option></select>
                                        </div>
                                        
                                        <!-- 多模板选择 -->
                                        <div id="multi-template-select" class="hidden">
                                            <div class="flex justify-between mb-2">
                                                <label class="block">选择多个模板</label>
                                                <div class="flex gap-2">
                                                    <button id="select-all-templates" class="text-xs bg-primary text-white px-2 py-1 rounded-md hover:bg-primary-dark focus:outline-none">全选</button>
                                                    <div class="flex items-center gap-1">
                                                        <input type="number" id="random-template-count" min="1" max="99" value="2" class="w-14 p-1 text-sm border rounded-md focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                                                        <button id="random-select-templates" class="text-xs bg-green-600 text-white px-2 py-1 rounded-md hover:bg-green-700 focus:outline-none">随机选择</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="template-checkboxes" class="max-h-[200px] overflow-y-auto border p-2 rounded-md dark:border-gray-600">
                                                <!-- 模板复选框会通过JS动态添加 -->
                                                <div class="text-gray-500 italic dark:text-gray-400">加载模板中...</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 p-5 rounded-2xl border border-indigo-200 shadow-sm">
                                    <h3 class="font-bold text-lg mb-4 text-indigo-800">输出设置</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label for="batch-output-format" class="block mb-2">输出格式</label>
                                            <select id="batch-output-format" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 text-base">
                                                <option value="html">HTML</option>
                                                <option value="md">Markdown</option>
                                                <option value="txt">TXT (HTML代码)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="batch-output-name" class="block mb-2">输出文件名前缀</label>
                                            <input type="text" id="batch-output-name" class="w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700 dark:border-gray-600 text-base" placeholder="可选，默认使用原文件名">
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="batch-output-zip" class="rounded text-primary focus:ring-primary dark:bg-gray-600" checked="">
                                            <label for="batch-output-zip">打包为ZIP文件下载</label>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="debug-mode" class="rounded text-primary focus:ring-primary dark:bg-gray-600">
                                            <label for="debug-mode">调试模式（显示详细日志）</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-6 space-y-3">
                                    <button id="start-batch" class="w-full bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-dark focus:outline-none">开始批量处理</button>
                                    <div id="batch-status" class="hidden bg-gray-100 dark:bg-gray-700 p-3 rounded-md">
                                        <div class="mb-2">处理进度：<span id="batch-progress">0</span>/<span id="batch-total">0</span></div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5">
                                            <div id="batch-progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div id="batch-log" class="hidden bg-gray-100 dark:bg-gray-700 p-3 rounded-md mt-2 max-h-[200px] overflow-y-auto text-xs">
                                        <!-- 处理日志会显示在这里 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 弹窗 -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-lg w-full max-h-[80vh] overflow-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-lg font-semibold">弹窗标题</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="modal-content">
                <!-- 弹窗内容将在这里显示 -->
            </div>
        </div>
    </div>

    <!-- 文件导入输入框 (隐藏) -->
    <input type="file" id="file-input" class="hidden" accept=".html,.md">
    <input type="file" id="batch-files-input" class="hidden" accept=".md,.markdown,.txt" multiple="">
    <input type="file" id="batch-folder-input" class="hidden" accept=".md,.markdown,.txt" webkitdirectory="" directory="" multiple="">
    <input type="file" id="template-import-input" class="hidden" accept=".json">

    <script>


        document.addEventListener('DOMContentLoaded', function() {
            // 样式配置对象
            let styleConfig = {
                global: {
                    centerContent: false,
                    font: "-apple-system-font, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif",
                    lineHeight: 1.75,
                    letterSpacing: 0.05
                },
                paragraph: {
                    fontSize: 16,
                    colorMode: "single",
                    color: "#000000",
                    colors: [],
                    randomColors: [],
                    randomCount: 3,
                    margin: 1
                },
                headings: {
                    h1: {
                        useTemplate: false,
                        templateContent: "",
                        templateName: "",
                        fontSize: 24,
                        color: "#000000",
                        bgColor: "#ffffff",
                        border: true
                    },
                    h2: {
                        useTemplate: false,
                        templateContent: "",
                        templateName: "",
                        fontSize: 20,
                        color: "#000000",
                        borderColor: "#5D5CDE"
                    },
                    h3: {
                        useTemplate: false,
                        templateContent: "",
                        templateName: "",
                        fontSize: 18,
                        color: "#000000"
                    }
                },
                emphasis: {
                    strong: {
                        colorMode: "single",
                        color: "#5D5CDE",
                        colors: [],
                        randomColors: [],
                        randomCount: 3,
                        bgColor: "#f0f0f0",
                        underline: false
                    },
                    em: {
                        colorMode: "single",
                        color: "#888888",
                        colors: [],
                        randomColors: [],
                        randomCount: 3,
                        keepItalic: true
                    },
                    blockquote: {
                        colorMode: "single",
                        color: "#666666",
                        colors: [],
                        randomColors: [],
                        randomCount: 3,
                        bgColor: "#f5f5f5",
                        borderColor: "#dddddd"
                    },
                    list: {
                        colorMode: "single",
                        color: "#000000",
                        colors: [],
                        randomColors: [],
                        randomCount: 3,
                        markerColor: "#666666",
                        bold: false
                    }
                },
                code: {
                    inlineColor: "#E83E8C",
                    inlineBgColor: "#f5f5f5",
                    blockTheme: "okaidia"
                },
                other: {
                    linkColor: "#5D5CDE",
                    hrStyle: "solid",
                    hrColor: "#eeeeee"
                },
                templates: {
                    top: {
                        useTemplate: false,
                        templateContent: "",
                        templateName: ""
                    },
                    bottom: {
                        useTemplate: false,
                        templateContent: "",
                        templateName: ""
                    }
                }
            };

            // 保存的模板
            let savedTemplates = {};
            
            // 批量处理相关变量
            let selectedFiles = [];
            let selectedTemplates = [];
            
            // DOM元素

            const articleTitle = document.getElementById('article-title');
            const articleContent = document.getElementById('article-content');
            const customFontContainer = document.getElementById('custom-font-container');
            const customFont = document.getElementById('custom-font');
            const importMdBtn = document.getElementById('import-md');
            const clearContentBtn = document.getElementById('clear-content');
            const previewContainer = document.getElementById('preview-container');
            const copyHtmlBtn = document.getElementById('copy-html');
            const copyWechatBtn = document.getElementById('copy-wechat');
            const downloadHtmlBtn = document.getElementById('download-html');
            const templateName = document.getElementById('template-name');
            const templateDesc = document.getElementById('template-desc');
            const saveTemplateBtn = document.getElementById('save-template');
            const templateList = document.getElementById('template-list');
            const startBatchBtn = document.getElementById('start-batch');
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const closeModal = document.getElementById('close-modal');
            const fileInput = document.getElementById('file-input');
            const batchFilesInput = document.getElementById('batch-files-input');
            const batchFolderInput = document.getElementById('batch-folder-input');
            const selectFilesBtn = document.getElementById('select-files-btn');
            const selectedFilesInfo = document.getElementById('selected-files-info');
            const selectedFilesCount = document.getElementById('selected-files-count');
            const batchOutputFormat = document.getElementById('batch-output-format');
            const batchOutputName = document.getElementById('batch-output-name');
            const batchOutputZip = document.getElementById('batch-output-zip');
            const templateCheckboxes = document.getElementById('template-checkboxes');
            const fileDebugInfo = document.getElementById('file-debug-info');
            const debugMode = document.getElementById('debug-mode');
            const batchLog = document.getElementById('batch-log');
            
            // 颜色模式选择
            const pColorMode = document.getElementById('p-color-mode');
            const strongColorMode = document.getElementById('strong-color-mode');
            const emColorMode = document.getElementById('em-color-mode');
            const blockquoteColorMode = document.getElementById('blockquote-color-mode');
            const listColorMode = document.getElementById('list-color-mode');
            
            // 全局字体选择
            const globalFont = document.getElementById('global-font');
            
            // 面板切换按钮
            const btnEdit = document.getElementById('btn-edit');
            const btnStyle = document.getElementById('btn-style');
            const btnTemplate = document.getElementById('btn-template');
            const btnBatch = document.getElementById('btn-batch');
            
            // 面板内容
            const panelEdit = document.getElementById('panel-edit');
            const panelStyle = document.getElementById('panel-style');
            const panelTemplate = document.getElementById('panel-template');
            const panelBatch = document.getElementById('panel-batch');

            // 字数统计元素
            const wordCount = document.getElementById('word-count');
            const chineseCount = document.getElementById('chinese-count');
            const englishCount = document.getElementById('english-count');
            const symbolCount = document.getElementById('symbol-count');
            
            // 多模板选择的按钮
            const selectAllTemplatesBtn = document.getElementById('select-all-templates');
            const randomSelectTemplatesBtn = document.getElementById('random-select-templates');
            const randomTemplateCount = document.getElementById('random-template-count');

            // 添加日志函数
            function addLog(message, type = 'info') {
                if (debugMode && !debugMode.checked && type === 'debug') return;
                
                if (batchLog) {
                    const logItem = document.createElement('div');
                    logItem.className = 'mb-1 border-b pb-1';
                    
                    // 根据日志类型设置样式
                    switch(type) {
                        case 'error':
                            logItem.className += ' text-red-500';
                            break;
                        case 'warning':
                            logItem.className += ' text-yellow-500';
                            break;
                        case 'success':
                            logItem.className += ' text-green-500';
                            break;
                        case 'info':
                        default:
                            logItem.className += ' text-gray-600 dark:text-gray-300';
                    }
                    
                    const timestamp = new Date().toLocaleTimeString();
                    logItem.textContent = `[${timestamp}] ${message}`;
                    batchLog.appendChild(logItem);
                    batchLog.scrollTop = batchLog.scrollHeight;
                }
                
                // 无论是否显示日志，都在控制台记录
                console.log(`[${type}] ${message}`);
            }
            
            // 启用调试模式时显示日志面板
            if (debugMode) {
                debugMode.addEventListener('change', function() {
                    if (this.checked && batchLog) {
                        batchLog.classList.remove('hidden');
                        addLog('调试模式已启用', 'info');
                    } else if (batchLog) {
                        batchLog.classList.add('hidden');
                    }
                });
            }
            
            // 设置面板中的表单元素
            const centerContent = document.getElementById('center-content');
            const lineHeight = document.getElementById('line-height');
            const lineHeightValue = document.getElementById('line-height-value');
            const letterSpacing = document.getElementById('letter-spacing');
            const letterSpacingValue = document.getElementById('letter-spacing-value');
            
            const pFontSize = document.getElementById('p-font-size');
            const pFontSizeValue = document.getElementById('p-font-size-value');
            const pColor = document.getElementById('p-color');
            const pColorHex = document.getElementById('p-color-hex');
            const randomPColorBtn = document.getElementById('random-p-color');
            const pMargin = document.getElementById('p-margin');
            const pMarginValue = document.getElementById('p-margin-value');
            
            // 标题设置元素
            const headingSelect = document.querySelectorAll('.heading-select');
            const headingSettings = document.querySelectorAll('.heading-settings');
            
            // 标题模板导入按钮
            const h1TemplateImport = document.getElementById('h1-template-import');
            const h2TemplateImport = document.getElementById('h2-template-import');
            const h3TemplateImport = document.getElementById('h3-template-import');
            const h1TemplateClear = document.getElementById('h1-template-clear');
            const h2TemplateClear = document.getElementById('h2-template-clear');
            const h3TemplateClear = document.getElementById('h3-template-clear');
            
            // 文章顶部和底部模板按钮
            const topTemplateImport = document.getElementById('top-template-import');
            const bottomTemplateImport = document.getElementById('bottom-template-import');
            const topTemplateClear = document.getElementById('top-template-clear');
            const bottomTemplateClear = document.getElementById('bottom-template-clear');
            
            // 强调设置元素
            const emphasisSelect = document.querySelectorAll('.emphasis-select');
            const emphasisSettings = document.querySelectorAll('.emphasis-settings');
            
            // 模板应用方式选择
            const singleTemplateSelect = document.getElementById('single-template-select');
            const multiTemplateSelect = document.getElementById('multi-template-select');
            
            // 初始化模板
            initializeSavedTemplates();
            
            // 初始化可拖拽的颜色列表
            initializeSortableLists();
            
            // 批量处理选择文件/文件夹
            selectFilesBtn.addEventListener('click', function() {
                const mode = document.querySelector('input[name="batch-mode"]:checked').value;
                if (mode === 'folder') {
                    batchFolderInput.click();
                } else {
                    batchFilesInput.click();
                }
            });
            
            // 监听文件选择
            batchFilesInput.addEventListener('change', function(e) {
                selectedFiles = Array.from(e.target.files).filter(file => 
                    file.name.endsWith('.md') || 
                    file.name.endsWith('.markdown') || 
                    file.name.endsWith('.txt')
                );
                updateSelectedFilesInfo();
            });
            
            batchFolderInput.addEventListener('change', function(e) {
                selectedFiles = Array.from(e.target.files).filter(file => 
                    file.name.endsWith('.md') || 
                    file.name.endsWith('.markdown') || 
                    file.name.endsWith('.txt')
                );
                updateSelectedFilesInfo();
            });
            
            // 更新选择文件信息
            function updateSelectedFilesInfo() {
                if (selectedFiles.length > 0) {
                    selectedFilesInfo.classList.remove('hidden');
                    selectedFilesCount.textContent = selectedFiles.length;
                    
                    if (debugMode && debugMode.checked && fileDebugInfo) {
                        fileDebugInfo.classList.remove('hidden');
                        fileDebugInfo.innerHTML = `
                            <div>选择的文件列表（前5个）:</div>
                            <ul class="pl-3 list-disc">
                                ${selectedFiles.slice(0, 5).map(file => 
                                    `<li>${file.name} (${(file.size / 1024).toFixed(2)}KB)</li>`
                                ).join('')}
                                ${selectedFiles.length > 5 ? `<li>... 以及其他 ${selectedFiles.length - 5} 个文件</li>` : ''}
                            </ul>
                        `;
                    } else if (fileDebugInfo) {
                        fileDebugInfo.classList.add('hidden');
                    }
                } else {
                    selectedFilesInfo.classList.add('hidden');
                    
                    if (fileDebugInfo) {
                        fileDebugInfo.classList.add('hidden');
                    }
                }
            }
            
            // 模板应用方式切换
            document.querySelectorAll('input[name="template-apply-mode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'single') {
                        singleTemplateSelect.classList.remove('hidden');
                        multiTemplateSelect.classList.add('hidden');
                    } else {
                        singleTemplateSelect.classList.add('hidden');
                        multiTemplateSelect.classList.remove('hidden');
                        populateTemplateCheckboxes();
                    }
                });
            });
            
            // 全选所有模板按钮
            selectAllTemplatesBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('input[name="template-cb"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
                updateSelectedTemplates();
                showNotification('已全选所有模板');
            });
            
            // 随机选择N个模板按钮
            randomSelectTemplatesBtn.addEventListener('click', function() {
                const count = parseInt(randomTemplateCount.value) || 2;
                const checkboxes = Array.from(document.querySelectorAll('input[name="template-cb"]'));
                
                if (checkboxes.length === 0) {
                    showNotification('没有可用的模板', 'error');
                    return;
                }
                
                // 先取消所有选择
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // 计算实际可选数量（不超过总模板数）
                const actualCount = Math.min(count, checkboxes.length);
                
                // 随机选择N个不重复的模板 - 使用Fisher-Yates洗牌算法提高效率
                const indices = Array.from({ length: checkboxes.length }, (_, i) => i);
                // 洗牌算法
                for (let i = indices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [indices[i], indices[j]] = [indices[j], indices[i]];
                }
                
                // 选择前actualCount个随机排序后的索引
                indices.slice(0, actualCount).forEach(index => {
                    checkboxes[index].checked = true;
                });
                
                updateSelectedTemplates();
                showNotification(`已随机选择 ${actualCount} 个模板`);
            });
            
            // 填充模板复选框
            function populateTemplateCheckboxes() {
                templateCheckboxes.innerHTML = '';
                
                if (Object.keys(savedTemplates).length === 0) {
                    templateCheckboxes.innerHTML = '<div class="text-gray-500 italic dark:text-gray-400">暂无可用模板</div>';
                    return;
                }
                
                for (const [name, data] of Object.entries(savedTemplates)) {
                    const templateItem = document.createElement('div');
                    templateItem.className = 'flex items-center mb-2';
                    templateItem.innerHTML = `
                        <input type="checkbox" id="template-cb-${name.replace(/\s+/g, '-')}" 
                               name="template-cb" value="${name}" 
                               class="mr-2 rounded text-primary focus:ring-primary dark:bg-gray-600">
                        <label for="template-cb-${name.replace(/\s+/g, '-')}">${name}</label>
                    `;
                    templateCheckboxes.appendChild(templateItem);
                }
                
                // 绑定复选框事件
                document.querySelectorAll('input[name="template-cb"]').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        updateSelectedTemplates();
                    });
                });
            }
            
            // 更新选中的模板
            function updateSelectedTemplates() {
                selectedTemplates = Array.from(document.querySelectorAll('input[name="template-cb"]:checked'))
                    .map(cb => cb.value);
            }

            // 按钮事件 - 切换面板
            btnEdit.addEventListener('click', () => switchPanel('edit'));
            btnStyle.addEventListener('click', () => switchPanel('style'));
            btnTemplate.addEventListener('click', () => switchPanel('template'));
            btnBatch.addEventListener('click', () => switchPanel('batch'));

            // 全局字体选择事件
            globalFont.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customFontContainer.classList.remove('hidden');
                    if (customFont.value) {
                        styleConfig.global.font = customFont.value;
                    }
                } else {
                    customFontContainer.classList.add('hidden');
                    styleConfig.global.font = this.value;
                    updatePreview();
                }
            });
            
            customFont.addEventListener('input', function() {
                if (globalFont.value === 'custom') {
                    styleConfig.global.font = this.value;
                    updatePreview();
                }
            });

            // 段落颜色模式切换
            pColorMode.addEventListener('change', function() {
                document.querySelectorAll('.p-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`p-color-${this.value}`).classList.remove('hidden');
                styleConfig.paragraph.colorMode = this.value;
                updatePreview();
            });
            
            // 粗体颜色模式切换
            strongColorMode.addEventListener('change', function() {
                document.querySelectorAll('.strong-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`strong-color-${this.value}`).classList.remove('hidden');
                styleConfig.emphasis.strong.colorMode = this.value;
                updatePreview();
            });
            
            // 斜体颜色模式切换
            emColorMode.addEventListener('change', function() {
                document.querySelectorAll('.em-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`em-color-${this.value}`).classList.remove('hidden');
                styleConfig.emphasis.em.colorMode = this.value;
                updatePreview();
            });
            
            // 引用颜色模式切换
            blockquoteColorMode.addEventListener('change', function() {
                document.querySelectorAll('.blockquote-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`blockquote-color-${this.value}`).classList.remove('hidden');
                styleConfig.emphasis.blockquote.colorMode = this.value;
                updatePreview();
            });
            
            // 列表颜色模式切换
            listColorMode.addEventListener('change', function() {
                document.querySelectorAll('.list-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`list-color-${this.value}`).classList.remove('hidden');
                styleConfig.emphasis.list.colorMode = this.value;
                updatePreview();
            });
            
            // 添加颜色按钮事件
            document.getElementById('add-p-color').addEventListener('click', () => addColor('p'));
            document.getElementById('add-strong-color').addEventListener('click', () => addColor('strong'));
            document.getElementById('add-em-color').addEventListener('click', () => addColor('em'));
            document.getElementById('add-blockquote-color').addEventListener('click', () => addColor('blockquote'));
            document.getElementById('add-list-color').addEventListener('click', () => addColor('list'));
            
            // 生成随机颜色按钮事件
            document.getElementById('generate-p-random').addEventListener('click', () => generateRandomColors('p'));
            document.getElementById('generate-strong-random').addEventListener('click', () => generateRandomColors('strong'));
            document.getElementById('generate-em-random').addEventListener('click', () => generateRandomColors('em'));
            document.getElementById('generate-blockquote-random').addEventListener('click', () => generateRandomColors('blockquote'));
            document.getElementById('generate-list-random').addEventListener('click', () => generateRandomColors('list'));
            
            // 随机颜色数量输入事件
            document.getElementById('p-random-count').addEventListener('input', function() {
                styleConfig.paragraph.randomCount = parseInt(this.value) || 3;
            });
            document.getElementById('strong-random-count').addEventListener('input', function() {
                styleConfig.emphasis.strong.randomCount = parseInt(this.value) || 3;
            });
            document.getElementById('em-random-count').addEventListener('input', function() {
                styleConfig.emphasis.em.randomCount = parseInt(this.value) || 3;
            });
            document.getElementById('blockquote-random-count').addEventListener('input', function() {
                styleConfig.emphasis.blockquote.randomCount = parseInt(this.value) || 3;
            });
            document.getElementById('list-random-count').addEventListener('input', function() {
                styleConfig.emphasis.list.randomCount = parseInt(this.value) || 3;
            });
            
            // 标题模板导入事件
            h1TemplateImport.addEventListener('click', () => importTemplate('h1'));
            h2TemplateImport.addEventListener('click', () => importTemplate('h2'));
            h3TemplateImport.addEventListener('click', () => importTemplate('h3'));
            
            // 标题模板清除事件
            h1TemplateClear.addEventListener('click', () => clearTemplate('h1'));
            h2TemplateClear.addEventListener('click', () => clearTemplate('h2'));
            h3TemplateClear.addEventListener('click', () => clearTemplate('h3'));
            
            // 文章顶部和底部模板导入事件
            topTemplateImport.addEventListener('click', () => importTemplate('top'));
            bottomTemplateImport.addEventListener('click', () => importTemplate('bottom'));
            
            // 文章顶部和底部模板清除事件
            topTemplateClear.addEventListener('click', () => clearTemplate('top'));
            bottomTemplateClear.addEventListener('click', () => clearTemplate('bottom'));
            
            // 文件选择事件
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const content = event.target.result;
                    
                    // 处理当前模板导入类型
                    if (fileInput.dataset.templateType) {
                        const templateType = fileInput.dataset.templateType;
                        processTemplateImport(templateType, content, file.name);
                    }
                };
                reader.readAsText(file);
            });

            // 切换面板函数
            function switchPanel(panelName) {
                // 重置所有按钮样式
                [btnEdit, btnStyle, btnTemplate, btnBatch].forEach(btn => {
                    btn.classList.remove('bg-gradient-primary', 'text-white');
                    btn.classList.add('bg-gradient-to-br', 'from-slate-100', 'to-slate-200', 'text-slate-700');
                });
                
                // 隐藏所有面板
                [panelEdit, panelStyle, panelTemplate, panelBatch].forEach(panel => {
                    panel.classList.add('hidden');
                });
                
                // 显示选中面板并高亮按钮
                switch(panelName) {
                    case 'edit':
                        panelEdit.classList.remove('hidden');
                        btnEdit.classList.remove('bg-gradient-to-br', 'from-slate-100', 'to-slate-200', 'text-slate-700');
                        btnEdit.classList.add('bg-gradient-primary', 'text-white');
                        break;
                    case 'style':
                        panelStyle.classList.remove('hidden');
                        btnStyle.classList.remove('bg-gradient-to-br', 'from-slate-100', 'to-slate-200', 'text-slate-700');
                        btnStyle.classList.add('bg-gradient-primary', 'text-white');
                        break;
                    case 'template':
                        panelTemplate.classList.remove('hidden');
                        btnTemplate.classList.remove('bg-gradient-to-br', 'from-slate-100', 'to-slate-200', 'text-slate-700');
                        btnTemplate.classList.add('bg-gradient-primary', 'text-white');
                        break;
                    case 'batch':
                        panelBatch.classList.remove('hidden');
                        btnBatch.classList.remove('bg-gradient-to-br', 'from-slate-100', 'to-slate-200', 'text-slate-700');
                        btnBatch.classList.add('bg-gradient-primary', 'text-white');
                        populateTemplateCheckboxes();
                        break;
                }
            }



            // 标题切换
            headingSelect.forEach(btn => {
                btn.addEventListener('click', () => {
                    const headingType = btn.dataset.heading;
                    
                    // 重置所有按钮样式
                    headingSelect.forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                        b.classList.add('bg-gray-200', 'dark:bg-gray-600');
                    });
                    
                    // 隐藏所有设置面板
                    headingSettings.forEach(panel => {
                        panel.classList.add('hidden');
                    });
                    
                    // 显示选中设置面板并高亮按钮
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-600');
                    btn.classList.add('bg-primary', 'text-white');
                    document.getElementById(`${headingType}-settings`).classList.remove('hidden');
                });
            });

            // 强调样式切换
            emphasisSelect.forEach(btn => {
                btn.addEventListener('click', () => {
                    const emphasisType = btn.dataset.emphasis;
                    
                    // 重置所有按钮样式
                    emphasisSelect.forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                        b.classList.add('bg-gray-200', 'dark:bg-gray-600');
                    });
                    
                    // 隐藏所有设置面板
                    emphasisSettings.forEach(panel => {
                        panel.classList.add('hidden');
                    });
                    
                    // 显示选中设置面板并高亮按钮
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-600');
                    btn.classList.add('bg-primary', 'text-white');
                    document.getElementById(`${emphasisType}-settings`).classList.remove('hidden');
                });
            });

            // 绑定颜色选择器和文本输入的双向更新
            function bindColorInputs(colorInput, hexInput) {
                colorInput.addEventListener('input', () => {
                    hexInput.value = colorInput.value;
                });
                
                hexInput.addEventListener('input', () => {
                    const hexValue = hexInput.value;
                    if (/^#[0-9A-Fa-f]{6}$/.test(hexValue)) {
                        colorInput.value = hexValue;
                    }
                });
                
                hexInput.addEventListener('blur', () => {
                    let hexValue = hexInput.value;
                    if (!hexValue.startsWith('#')) {
                        hexValue = '#' + hexValue;
                    }
                    if (/^#[0-9A-Fa-f]{3}$/.test(hexValue)) {
                        // 将3位HEX转换为6位
                        hexValue = '#' + hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2] + hexValue[3] + hexValue[3];
                    }
                    if (/^#[0-9A-Fa-f]{6}$/.test(hexValue)) {
                        hexInput.value = hexValue;
                        colorInput.value = hexValue;
                    } else {
                        // 无效HEX，重置为颜色选择器的值
                        hexInput.value = colorInput.value;
                    }
                });
            }

            // 绑定所有颜色选择器
            const colorInputPairs = [
                [pColor, pColorHex],
                [document.getElementById('h1-color'), document.getElementById('h1-color-hex')],
                [document.getElementById('h1-bg-color'), document.getElementById('h1-bg-color-hex')],
                [document.getElementById('h2-color'), document.getElementById('h2-color-hex')],
                [document.getElementById('h2-border-color'), document.getElementById('h2-border-color-hex')],
                [document.getElementById('h3-color'), document.getElementById('h3-color-hex')],
                [document.getElementById('strong-color'), document.getElementById('strong-color-hex')],
                [document.getElementById('strong-bg-color'), document.getElementById('strong-bg-color-hex')],
                [document.getElementById('em-color'), document.getElementById('em-color-hex')],
                [document.getElementById('blockquote-color'), document.getElementById('blockquote-color-hex')],
                [document.getElementById('blockquote-bg-color'), document.getElementById('blockquote-bg-color-hex')],
                [document.getElementById('blockquote-border-color'), document.getElementById('blockquote-border-color-hex')],
                [document.getElementById('list-color'), document.getElementById('list-color-hex')],
                [document.getElementById('list-marker-color'), document.getElementById('list-marker-color-hex')],
                [document.getElementById('code-color'), document.getElementById('code-bg-color')],
                [document.getElementById('link-color'), document.getElementById('link-color-hex')],
                [document.getElementById('hr-color'), document.getElementById('hr-color-hex')]
            ];
            
            colorInputPairs.forEach(pair => {
                if (pair[0] && pair[1]) {
                    bindColorInputs(pair[0], pair[1]);
                }
            });

            // 绑定范围滑块和文本值显示
            lineHeight.addEventListener('input', () => {
                lineHeightValue.textContent = lineHeight.value;
                styleConfig.global.lineHeight = parseFloat(lineHeight.value);
                updatePreview();
            });
            
            letterSpacing.addEventListener('input', () => {
                letterSpacingValue.textContent = letterSpacing.value + 'em';
                styleConfig.global.letterSpacing = parseFloat(letterSpacing.value);
                updatePreview();
            });
            
            pFontSize.addEventListener('input', () => {
                pFontSizeValue.textContent = pFontSize.value + 'px';
                styleConfig.paragraph.fontSize = parseInt(pFontSize.value);
                updatePreview();
            });
            
            pMargin.addEventListener('input', () => {
                pMarginValue.textContent = pMargin.value + 'em';
                styleConfig.paragraph.margin = parseFloat(pMargin.value);
                updatePreview();
            });

            // 绑定H1-H3的字体大小滑块
            document.getElementById('h1-font-size').addEventListener('input', () => {
                const val = document.getElementById('h1-font-size').value;
                document.getElementById('h1-font-size-value').textContent = val + 'px';
                styleConfig.headings.h1.fontSize = parseInt(val);
                updatePreview();
            });
            
            document.getElementById('h2-font-size').addEventListener('input', () => {
                const val = document.getElementById('h2-font-size').value;
                document.getElementById('h2-font-size-value').textContent = val + 'px';
                styleConfig.headings.h2.fontSize = parseInt(val);
                updatePreview();
            });
            
            document.getElementById('h3-font-size').addEventListener('input', () => {
                const val = document.getElementById('h3-font-size').value;
                document.getElementById('h3-font-size-value').textContent = val + 'px';
                styleConfig.headings.h3.fontSize = parseInt(val);
                updatePreview();
            });

            // 随机颜色按钮
            function getRandomColor() {
                return '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
            }
            
            randomPColorBtn.addEventListener('click', () => {
                const randomColor = getRandomColor();
                pColor.value = randomColor;
                pColorHex.value = randomColor;
                styleConfig.paragraph.color = randomColor;
                updatePreview();
            });
            
            document.getElementById('random-strong-color').addEventListener('click', () => {
                const randomColor = getRandomColor();
                document.getElementById('strong-color').value = randomColor;
                document.getElementById('strong-color-hex').value = randomColor;
                styleConfig.emphasis.strong.color = randomColor;
                updatePreview();
            });
            
            document.getElementById('random-em-color').addEventListener('click', () => {
                const randomColor = getRandomColor();
                document.getElementById('em-color').value = randomColor;
                document.getElementById('em-color-hex').value = randomColor;
                styleConfig.emphasis.em.color = randomColor;
                updatePreview();
            });
            
            document.getElementById('random-blockquote-color').addEventListener('click', () => {
                const randomColor = getRandomColor();
                document.getElementById('blockquote-color').value = randomColor;
                document.getElementById('blockquote-color-hex').value = randomColor;
                styleConfig.emphasis.blockquote.color = randomColor;
                updatePreview();
            });
            
            document.getElementById('random-list-color').addEventListener('click', () => {
                const randomColor = getRandomColor();
                document.getElementById('list-color').value = randomColor;
                document.getElementById('list-color-hex').value = randomColor;
                styleConfig.emphasis.list.color = randomColor;
                updatePreview();
            });

            // 绑定其他样式设置变更
            centerContent.addEventListener('change', () => {
                styleConfig.global.centerContent = centerContent.checked;
                updatePreview();
            });
            
            pColor.addEventListener('input', () => {
                styleConfig.paragraph.color = pColor.value;
                updatePreview();
            });
            
            document.getElementById('h1-color').addEventListener('input', () => {
                styleConfig.headings.h1.color = document.getElementById('h1-color').value;
                updatePreview();
            });
            
            document.getElementById('h1-bg-color').addEventListener('input', () => {
                styleConfig.headings.h1.bgColor = document.getElementById('h1-bg-color').value;
                updatePreview();
            });
            
            document.getElementById('h1-border').addEventListener('change', () => {
                styleConfig.headings.h1.border = document.getElementById('h1-border').checked;
                updatePreview();
            });
            
            document.getElementById('h2-color').addEventListener('input', () => {
                styleConfig.headings.h2.color = document.getElementById('h2-color').value;
                updatePreview();
            });
            
            document.getElementById('h2-border-color').addEventListener('input', () => {
                styleConfig.headings.h2.borderColor = document.getElementById('h2-border-color').value;
                updatePreview();
            });
            
            document.getElementById('h3-color').addEventListener('input', () => {
                styleConfig.headings.h3.color = document.getElementById('h3-color').value;
                updatePreview();
            });
            
            document.getElementById('strong-color').addEventListener('input', () => {
                styleConfig.emphasis.strong.color = document.getElementById('strong-color').value;
                updatePreview();
            });
            
            document.getElementById('strong-bg-color').addEventListener('input', () => {
                styleConfig.emphasis.strong.bgColor = document.getElementById('strong-bg-color').value;
                updatePreview();
            });
            
            document.getElementById('strong-underline').addEventListener('change', () => {
                styleConfig.emphasis.strong.underline = document.getElementById('strong-underline').checked;
                updatePreview();
            });
            
            document.getElementById('em-color').addEventListener('input', () => {
                styleConfig.emphasis.em.color = document.getElementById('em-color').value;
                updatePreview();
            });
            
            document.getElementById('em-keep-italic').addEventListener('change', () => {
                styleConfig.emphasis.em.keepItalic = document.getElementById('em-keep-italic').checked;
                updatePreview();
            });
            
            document.getElementById('blockquote-color').addEventListener('input', () => {
                styleConfig.emphasis.blockquote.color = document.getElementById('blockquote-color').value;
                updatePreview();
            });
            
            document.getElementById('blockquote-bg-color').addEventListener('input', () => {
                styleConfig.emphasis.blockquote.bgColor = document.getElementById('blockquote-bg-color').value;
                updatePreview();
            });
            
            document.getElementById('blockquote-border-color').addEventListener('input', () => {
                styleConfig.emphasis.blockquote.borderColor = document.getElementById('blockquote-border-color').value;
                updatePreview();
            });
            
            document.getElementById('list-color').addEventListener('input', () => {
                styleConfig.emphasis.list.color = document.getElementById('list-color').value;
                updatePreview();
            });
            
            document.getElementById('list-marker-color').addEventListener('input', () => {
                styleConfig.emphasis.list.markerColor = document.getElementById('list-marker-color').value;
                updatePreview();
            });
            
            document.getElementById('list-bold').addEventListener('change', () => {
                styleConfig.emphasis.list.bold = document.getElementById('list-bold').checked;
                updatePreview();
            });
            
            document.getElementById('code-color').addEventListener('input', () => {
                styleConfig.code.inlineColor = document.getElementById('code-color').value;
                updatePreview();
            });
            
            document.getElementById('code-bg-color').addEventListener('input', () => {
                styleConfig.code.inlineBgColor = document.getElementById('code-bg-color').value;
                updatePreview();
            });
            
            document.getElementById('code-block-theme').addEventListener('change', () => {
                styleConfig.code.blockTheme = document.getElementById('code-block-theme').value;
                updatePreview();
            });
            
            document.getElementById('link-color').addEventListener('input', () => {
                styleConfig.other.linkColor = document.getElementById('link-color').value;
                updatePreview();
            });
            
            document.getElementById('hr-style').addEventListener('change', () => {
                styleConfig.other.hrStyle = document.getElementById('hr-style').value;
                updatePreview();
            });
            
            document.getElementById('hr-color').addEventListener('input', () => {
                styleConfig.other.hrColor = document.getElementById('hr-color').value;
                updatePreview();
            });

            // Markdown内容变更时更新预览
            articleContent.addEventListener('input', () => {
                updateWordCount();
                updatePreview();
            });
            
            // 文章标题变更时更新预览
            articleTitle.addEventListener('input', updatePreview);

            // 更新字数统计
            function updateWordCount() {
                const content = articleContent.value;
                
                // 中文字数
                const chineseMatches = content.match(/[\u4e00-\u9fa5]/g);
                const chineseNum = chineseMatches ? chineseMatches.length : 0;
                
                // 英文单词
                const englishMatches = content.match(/[a-zA-Z]+/g);
                const englishNum = englishMatches ? englishMatches.length : 0;
                
                // 符号数量
                const symbolMatches = content.match(/[^\u4e00-\u9fa5a-zA-Z0-9\s]/g);
                const symbolNum = symbolMatches ? symbolMatches.length : 0;
                
                // 总字数
                const total = chineseNum + englishNum;
                
                wordCount.textContent = total;
                chineseCount.textContent = chineseNum;
                englishCount.textContent = englishNum;
                symbolCount.textContent = symbolNum;
            }

            // 清空内容
            clearContentBtn.addEventListener('click', () => {
                if (confirm('确定要清空所有内容吗？')) {
                    articleTitle.value = '';
                    articleContent.value = '';
                    updateWordCount();
                    updatePreview();
                }
            });

            // 导入MD文件
            importMdBtn.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.md,.markdown,.txt';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = event => {
                        const content = event.target.result;
                        
                        // 尝试从文件名或内容中提取标题
                        let title = file.name.replace(/\.(md|markdown|txt)$/i, '');
                        let markdownContent = content;
                        
                        // 检查内容的第一行是否为标题格式
                        const firstLine = content.split('\n')[0];
                        if (firstLine.startsWith('# ')) {
                            // 使用第一行作为标题，并从内容中移除
                            title = firstLine.replace('# ', '');
                            markdownContent = content.substring(content.indexOf('\n') + 1).trim();
                        }
                        
                        articleTitle.value = title;
                        articleContent.value = markdownContent;
                        updateWordCount();
                        updatePreview();
                    };
                    reader.readAsText(file);
                };
                
                input.click();
            });
            
            // 导入模板文件
            function importTemplate(type) {
                fileInput.dataset.templateType = type;
                fileInput.accept = '.html';
                fileInput.click();
            }
            
            // 处理模板导入
            function processTemplateImport(type, content, filename) {
                // 设置模板内容和名称
                if (type === 'h1' || type === 'h2' || type === 'h3') {
                    styleConfig.headings[type].useTemplate = true;
                    styleConfig.headings[type].templateContent = content;
                    styleConfig.headings[type].templateName = filename;
                    
                    // 更新UI
                    document.getElementById(`${type}-template-info`).classList.remove('hidden');
                    document.getElementById(`${type}-template-name`).textContent = filename;
                    document.getElementById(`${type}-standard-settings`).classList.add('hidden');
                } else if (type === 'top' || type === 'bottom') {
                    styleConfig.templates[type].useTemplate = true;
                    styleConfig.templates[type].templateContent = content;
                    styleConfig.templates[type].templateName = filename;
                    
                    // 更新UI
                    document.getElementById(`${type}-template-info`).classList.remove('hidden');
                    document.getElementById(`${type}-template-name`).textContent = filename;
                    document.getElementById(`${type}-template-preview`).classList.remove('hidden');
                    document.getElementById(`${type}-template-preview`).innerHTML = content;
                }
                
                // 清除文件输入
                fileInput.value = '';
                delete fileInput.dataset.templateType;
                
                // 更新预览
                updatePreview();
                
                // 显示成功通知
                showNotification(`${type.toUpperCase()}模板已导入成功`);
            }
            
            // 清除模板
            function clearTemplate(type) {
                if (type === 'h1' || type === 'h2' || type === 'h3') {
                    styleConfig.headings[type].useTemplate = false;
                    styleConfig.headings[type].templateContent = "";
                    styleConfig.headings[type].templateName = "";
                    
                    // 更新UI
                    document.getElementById(`${type}-template-info`).classList.add('hidden');
                    document.getElementById(`${type}-standard-settings`).classList.remove('hidden');
                } else if (type === 'top' || type === 'bottom') {
                    styleConfig.templates[type].useTemplate = false;
                    styleConfig.templates[type].templateContent = "";
                    styleConfig.templates[type].templateName = "";
                    
                    // 更新UI
                    document.getElementById(`${type}-template-info`).classList.add('hidden');
                    document.getElementById(`${type}-template-preview`).classList.add('hidden');
                }
                
                // 更新预览
                updatePreview();
                
                // 显示成功通知
                showNotification(`${type.toUpperCase()}模板已清除`);
            }

            // 更新预览
            function updatePreview() {
                const content = articleContent.value || '<div class="text-center py-10 text-gray-500"><p>请在左侧输入内容或导入Markdown文件</p></div>';
                
                // 将Markdown转换为HTML
                let htmlContent = marked.parse(content);
                
                // 应用顶部模板
                let topContent = '';
                if (styleConfig.templates.top.useTemplate && styleConfig.templates.top.templateContent) {
                    topContent = styleConfig.templates.top.templateContent;
                }
                
                // 应用底部模板
                let bottomContent = '';
                if (styleConfig.templates.bottom.useTemplate && styleConfig.templates.bottom.templateContent) {
                    bottomContent = styleConfig.templates.bottom.templateContent;
                }
                
                // 处理标题模板
                if (styleConfig.headings.h1.useTemplate) {
                    // 查找所有h1标签并使用模板样式
                    // 默认使用模板本身的样式，不受粗体样式影响
                }
                
                if (styleConfig.headings.h2.useTemplate) {
                    // 查找所有h2标签并应用模板
                    const h2Regex = /<h2[^>]*>(.*?)<\/h2>/g;
                    htmlContent = htmlContent.replace(h2Regex, (match, text) => {
                        let template = styleConfig.headings.h2.templateContent;
                        return template.replace('{h2_text}', text);
                    });
                }
                
                if (styleConfig.headings.h3.useTemplate) {
                    // 查找所有h3标签并使用模板样式
                    // 默认使用模板本身的样式，不受粗体样式影响
                }
                
                // 生成CSS
                const css = generateCSS();
                
                // 创建预览HTML
                const previewHtml = `
                    <style>${css}</style>
                    <div class="wechat-article">
                        <div class="article-content">
                            ${topContent}
                            ${htmlContent}
                            ${bottomContent}
                        </div>
                    </div>
                `;
                
                previewContainer.innerHTML = previewHtml;
                
                // 如果有代码块，应用Prism高亮
                Prism.highlightAllUnder(previewContainer);
            }

            // 生成CSS代码
            function generateCSS() {
                // 基础样式
                let css = `
                    .wechat-article {
                        font-family: ${styleConfig.global.font};
                        line-height: ${styleConfig.global.lineHeight};
                        letter-spacing: ${styleConfig.global.letterSpacing}em;
                        color: ${styleConfig.paragraph.color};
                        ${styleConfig.global.centerContent ? 'text-align: center;' : ''}
                    }
                    
                    .article-content {
                        margin: 0 auto;
                        max-width: 100%;
                        word-wrap: break-word;
                    }
                `;
                
                // 段落样式
                if (styleConfig.paragraph.colorMode === 'single') {
                    css += `
                        .article-content p {
                            font-size: ${styleConfig.paragraph.fontSize}px;
                            margin: ${styleConfig.paragraph.margin}em 0;
                            color: ${styleConfig.paragraph.color};
                        }
                    `;
                } else if (styleConfig.paragraph.colorMode === 'multiple' && styleConfig.paragraph.colors.length > 0) {
                    // 多色轮换模式
                    styleConfig.paragraph.colors.forEach((color, index) => {
                        css += `
                            .article-content p:nth-of-type(${styleConfig.paragraph.colors.length}n+${index+1}) {
                                font-size: ${styleConfig.paragraph.fontSize}px;
                                margin: ${styleConfig.paragraph.margin}em 0;
                                color: ${color};
                            }
                        `;
                    });
                } else if (styleConfig.paragraph.colorMode === 'random' && styleConfig.paragraph.randomColors.length > 0) {
                    // 随机颜色模式
                    styleConfig.paragraph.randomColors.forEach((color, index) => {
                        css += `
                            .article-content p:nth-of-type(${styleConfig.paragraph.randomColors.length}n+${index+1}) {
                                font-size: ${styleConfig.paragraph.fontSize}px;
                                margin: ${styleConfig.paragraph.margin}em 0;
                                color: ${color};
                            }
                        `;
                    });
                } else {
                    // 如果未设置颜色数组或模式，使用单色
                    css += `
                        .article-content p {
                            font-size: ${styleConfig.paragraph.fontSize}px;
                            margin: ${styleConfig.paragraph.margin}em 0;
                            color: ${styleConfig.paragraph.color};
                        }
                    `;
                }
                
                // 标题样式（如果没有使用模板）
                if (!styleConfig.headings.h1.useTemplate) {
                    css += `
                        .article-content h1 {
                            font-size: ${styleConfig.headings.h1.fontSize}px;
                            color: ${styleConfig.headings.h1.color}; 
                            background-color: ${styleConfig.headings.h1.bgColor};
                            padding: 10px;
                            ${styleConfig.headings.h1.border ? `border-bottom: 2px solid ${styleConfig.headings.h1.color};` : ''}
                            margin: 1.5em 0 1em;
                        }
                    `;
                }
                
                if (!styleConfig.headings.h2.useTemplate) {
                    css += `
                        .article-content h2 {
                            font-size: ${styleConfig.headings.h2.fontSize}px;
                            color: ${styleConfig.headings.h2.color}; 
                            border-left: 5px solid ${styleConfig.headings.h2.borderColor};
                            padding-left: 10px;
                            margin: 1.5em 0 1em;
                        }
                    `;
                }
                
                if (!styleConfig.headings.h3.useTemplate) {
                    css += `
                        .article-content h3 {
                            font-size: ${styleConfig.headings.h3.fontSize}px;
                            color: ${styleConfig.headings.h3.color}; 
                            margin: 1.2em 0.8em;
                        }
                    `;
                }
                
                // 强调样式 - 粗体
                if (styleConfig.emphasis.strong.colorMode === 'single') {
                    css += `
                        .article-content strong {
                            color: ${styleConfig.emphasis.strong.color};
                            background-color: ${styleConfig.emphasis.strong.bgColor};
                            padding: 0 2px;
                            ${styleConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                        }
                    `;
                } else if (styleConfig.emphasis.strong.colorMode === 'multiple' && styleConfig.emphasis.strong.colors.length > 0) {
                    // 多色轮换模式
                    styleConfig.emphasis.strong.colors.forEach((color, index) => {
                        css += `
                            .article-content strong:nth-of-type(${styleConfig.emphasis.strong.colors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${styleConfig.emphasis.strong.bgColor};
                                padding: 0 2px;
                                ${styleConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                            }
                        `;
                    });
                } else if (styleConfig.emphasis.strong.colorMode === 'random' && styleConfig.emphasis.strong.randomColors.length > 0) {
                    // 随机颜色模式
                    styleConfig.emphasis.strong.randomColors.forEach((color, index) => {
                        css += `
                            .article-content strong:nth-of-type(${styleConfig.emphasis.strong.randomColors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${styleConfig.emphasis.strong.bgColor};
                                padding: 0 2px;
                                ${styleConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                            }
                        `;
                    });
                } else {
                    // 未设置颜色数组或模式，使用单色
                    css += `
                        .article-content strong {
                            color: ${styleConfig.emphasis.strong.color};
                            background-color: ${styleConfig.emphasis.strong.bgColor};
                            padding: 0 2px;
                            ${styleConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                        }
                    `;
                }
                
                // 强调样式 - 斜体
                if (styleConfig.emphasis.em.colorMode === 'single') {
                    css += `
                        .article-content em {
                            color: ${styleConfig.emphasis.em.color};
                            ${styleConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                        }
                    `;
                } else if (styleConfig.emphasis.em.colorMode === 'multiple' && styleConfig.emphasis.em.colors.length > 0) {
                    // 多色轮换模式
                    styleConfig.emphasis.em.colors.forEach((color, index) => {
                        css += `
                            .article-content em:nth-of-type(${styleConfig.emphasis.em.colors.length}n+${index+1}) {
                                color: ${color};
                                ${styleConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                            }
                        `;
                    });
                } else if (styleConfig.emphasis.em.colorMode === 'random' && styleConfig.emphasis.em.randomColors.length > 0) {
                    // 随机颜色模式
                    styleConfig.emphasis.em.randomColors.forEach((color, index) => {
                        css += `
                            .article-content em:nth-of-type(${styleConfig.emphasis.em.randomColors.length}n+${index+1}) {
                                color: ${color};
                                ${styleConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                            }
                        `;
                    });
                } else {
                    // 未设置颜色数组或模式，使用单色
                    css += `
                        .article-content em {
                            color: ${styleConfig.emphasis.em.color};
                            ${styleConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                        }
                    `;
                }
                
                // 强调样式 - 引用
                if (styleConfig.emphasis.blockquote.colorMode === 'single') {
                    css += `
                        .article-content blockquote {
                            color: ${styleConfig.emphasis.blockquote.color};
                            background-color: ${styleConfig.emphasis.blockquote.bgColor};
                            border-left: 4px solid ${styleConfig.emphasis.blockquote.borderColor};
                            padding: 10px 15px;
                            margin: 1em 0;
                        }
                        
                        .article-content blockquote p {
                            color: ${styleConfig.emphasis.blockquote.color} !important;
                        }
                    `;
                } else if (styleConfig.emphasis.blockquote.colorMode === 'multiple' && styleConfig.emphasis.blockquote.colors.length > 0) {
                    // 多色轮换模式
                    styleConfig.emphasis.blockquote.colors.forEach((color, index) => {
                        css += `
                            .article-content blockquote:nth-of-type(${styleConfig.emphasis.blockquote.colors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${styleConfig.emphasis.blockquote.bgColor};
                                border-left: 4px solid ${styleConfig.emphasis.blockquote.borderColor};
                                padding: 10px 15px;
                                margin: 1em 0;
                            }
                            
                            .article-content blockquote:nth-of-type(${styleConfig.emphasis.blockquote.colors.length}n+${index+1}) p {
                                color: ${color} !important;
                            }
                        `;
                    });
                } else if (styleConfig.emphasis.blockquote.colorMode === 'random' && styleConfig.emphasis.blockquote.randomColors.length > 0) {
                    // 随机颜色模式
                    styleConfig.emphasis.blockquote.randomColors.forEach((color, index) => {
                        css += `
                            .article-content blockquote:nth-of-type(${styleConfig.emphasis.blockquote.randomColors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${styleConfig.emphasis.blockquote.bgColor};
                                border-left: 4px solid ${styleConfig.emphasis.blockquote.borderColor};
                                padding: 10px 15px;
                                margin: 1em 0;
                            }
                            
                            .article-content blockquote:nth-of-type(${styleConfig.emphasis.blockquote.randomColors.length}n+${index+1}) p {
                                color: ${color} !important;
                            }
                        `;
                    });
                } else {
                    // 未设置颜色数组或模式，使用单色
                    css += `
                        .article-content blockquote {
                            color: ${styleConfig.emphasis.blockquote.color};
                            background-color: ${styleConfig.emphasis.blockquote.bgColor};
                            border-left: 4px solid ${styleConfig.emphasis.blockquote.borderColor};
                            padding: 10px 15px;
                            margin: 1em 0;
                        }
                        
                        .article-content blockquote p {
                            color: ${styleConfig.emphasis.blockquote.color} !important;
                        }
                    `;
                }
                
                // 列表样式
                let listItemStyle = `
                    .article-content li {
                `;
                
                if (styleConfig.emphasis.list.colorMode === 'single') {
                    listItemStyle += `color: ${styleConfig.emphasis.list.color};`;
                }
                
                if (styleConfig.emphasis.list.bold) {
                    listItemStyle += `font-weight: bold;`;
                }
                
                listItemStyle += `}`;
                css += listItemStyle;
                
                // 列表多色模式
                if (styleConfig.emphasis.list.colorMode === 'multiple' && styleConfig.emphasis.list.colors.length > 0) {
                    // 多色轮换模式
                    styleConfig.emphasis.list.colors.forEach((color, index) => {
                        css += `
                            .article-content li:nth-of-type(${styleConfig.emphasis.list.colors.length}n+${index+1}) {
                                color: ${color};
                                ${styleConfig.emphasis.list.bold ? 'font-weight: bold;' : ''}
                            }
                        `;
                    });
                } else if (styleConfig.emphasis.list.colorMode === 'random' && styleConfig.emphasis.list.randomColors.length > 0) {
                    // 随机颜色模式
                    styleConfig.emphasis.list.randomColors.forEach((color, index) => {
                        css += `
                            .article-content li:nth-of-type(${styleConfig.emphasis.list.randomColors.length}n+${index+1}) {
                                color: ${color};
                                ${styleConfig.emphasis.list.bold ? 'font-weight: bold;' : ''}
                            }
                        `;
                    });
                }
                
                // 列表marker颜色 (项目符号和数字)
                css += `
                    .article-content ul li::marker,
                    .article-content ol li::marker {
                        color: ${styleConfig.emphasis.list.markerColor};
                    }
                `;
                
                // 其他样式
                css += `
                    .article-content code {
                        color: ${styleConfig.code.inlineColor};
                        background-color: ${styleConfig.code.inlineBgColor};
                        padding: 2px 4px;
                        border-radius: 3px;
                        font-family: Consolas, Monaco, 'Courier New', monospace;
                        font-size: 0.9em;
                    }
                    
                    .article-content pre {
                        margin: 1em 0;
                        padding: 0;
                        overflow: auto;
                    }
                    
                    .article-content pre > code {
                        display: block;
                        padding: 10px;
                        color: inherit;
                        background-color: #282c34;
                        border-radius: 5px;
                        overflow-x: auto;
                    }
                    
                    .article-content a {
                        color: ${styleConfig.other.linkColor};
                        text-decoration: none;
                        border-bottom: 1px solid ${styleConfig.other.linkColor};
                    }
                    
                    .article-content hr {
                        border: none;
                        border-top: 1px ${styleConfig.other.hrStyle} ${styleConfig.other.hrColor};
                        margin: 2em 0;
                    }
                    
                    .article-content img {
                        max-width: 100%;
                        height: auto;
                        display: block;
                        margin: 1em auto;
                        border-radius: 5px;
                    }
                    
                    .article-content table {
                        border-collapse: collapse;
                        width: 100%;
                        margin: 1em 0;
                    }
                    
                    .article-content th, .article-content td {
                        border: 1px solid #ddd;
                        padding: 8px;
                        text-align: left;
                    }
                    
                    .article-content th {
                        background-color: #f5f5f5;
                    }
                    
                    .article-content ul, .article-content ol {
                        padding-left: 2em;
                        margin: 1em 0;
                    }
                `;
                
                return css;
            }
            
            // 初始化内存中的模板
            function initializeSavedTemplates() {
                // 定义原有的内置模板
                const builtInTemplates = {
                    "深色专业": {
                        type: "built-in",
                        description: "深色背景的专业风格排版",
                        styleConfig: {
                            global: {
                                centerContent: false,
                                font: "'Noto Sans SC', sans-serif",
                                lineHeight: 1.8,
                                letterSpacing: 0.06
                            },
                            paragraph: {
                                fontSize: 16,
                                colorMode: "single",
                                color: "#333333",
                                colors: [],
                                randomColors: [],
                                randomCount: 3,
                                margin: 1.2
                            },
                            headings: {
                                h1: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 26,
                                    color: "#1a73e8",
                                    bgColor: "#eaf3ff",
                                    border: true
                                },
                                h2: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 22,
                                    color: "#1a73e8",
                                    borderColor: "#1a73e8"
                                },
                                h3: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 18,
                                    color: "#1a73e8"
                                }
                            },
                            emphasis: {
                                strong: {
                                    colorMode: "single",
                                    color: "#0d5bdd",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    bgColor: "#e8f0fe",
                                    underline: false
                                },
                                em: {
                                    colorMode: "single",
                                    color: "#444444",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    keepItalic: true
                                },
                                blockquote: {
                                    colorMode: "single",
                                    color: "#444444",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    bgColor: "#f5f8ff",
                                    borderColor: "#c8d8f7"
                                },
                                list: {
                                    colorMode: "single",
                                    color: "#333333",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    markerColor: "#1a73e8",
                                    bold: false
                                }
                            },
                            code: {
                                inlineColor: "#d93025",
                                inlineBgColor: "#fce8e6",
                                blockTheme: "okaidia"
                            },
                            other: {
                                linkColor: "#1a73e8",
                                hrStyle: "solid",
                                hrColor: "#dadce0"
                            },
                            templates: {
                                top: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: ""
                                },
                                bottom: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: ""
                                }
                            }
                        },
                        timestamp: new Date().toISOString()
                    },
                    "多彩活泼": {
                        type: "built-in",
                        description: "彩色活泼的风格，适合轻松愉快的文章",
                        styleConfig: {
                            global: {
                                centerContent: false,
                                font: "'Microsoft YaHei', sans-serif",
                                lineHeight: 1.85,
                                letterSpacing: 0.08
                            },
                            paragraph: {
                                fontSize: 16,
                                colorMode: "multiple",
                                color: "#333333",
                                colors: ["#e74c3c", "#3498db", "#2ecc71", "#f39c12", "#9b59b6"],
                                randomColors: [],
                                randomCount: 5,
                                margin: 1.2
                            },
                            headings: {
                                h1: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 26,
                                    color: "#e74c3c",
                                    bgColor: "#ffedeb",
                                    border: true
                                },
                                h2: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 22,
                                    color: "#3498db",
                                    borderColor: "#3498db"
                                },
                                h3: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 18,
                                    color: "#2ecc71"
                                }
                            },
                            emphasis: {
                                strong: {
                                    colorMode: "multiple",
                                    color: "#e74c3c",
                                    colors: ["#e74c3c", "#3498db", "#2ecc71", "#f39c12", "#9b59b6"],
                                    randomColors: [],
                                    randomCount: 3,
                                    bgColor: "#fff3f0",
                                    underline: false
                                },
                                em: {
                                    colorMode: "multiple",
                                    color: "#9b59b6",
                                    colors: ["#9b59b6", "#f39c12", "#e74c3c"],
                                    randomColors: [],
                                    randomCount: 3,
                                    keepItalic: true
                                },
                                blockquote: {
                                    colorMode: "single",
                                    color: "#555555",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    bgColor: "#f9f9f9",
                                    borderColor: "#f39c12"
                                },
                                list: {
                                    colorMode: "single",
                                    color: "#333333",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    markerColor: "#3498db",
                                    bold: false
                                }
                            },
                            code: {
                                inlineColor: "#e74c3c",
                                inlineBgColor: "#fff3f0",
                                blockTheme: "okaidia"
                            },
                            other: {
                                linkColor: "#3498db",
                                hrStyle: "dashed",
                                hrColor: "#ecf0f1"
                            },
                            templates: {
                                top: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: ""
                                },
                                bottom: {
                                    useTemplate: true,
                                    templateContent: "请点赞、点在看、点收藏",
                                    templateName: "标准底部"
                                }
                            }
                        },
                        timestamp: new Date().toISOString()
                    },
                    "优雅简约": {
                        type: "built-in",
                        description: "简约优雅的风格，适合文学和思考类文章",
                        styleConfig: {
                            global: {
                                centerContent: false,
                                font: "'Georgia', 'Times New Roman', 'SimSun', serif",
                                lineHeight: 1.9,
                                letterSpacing: 0.06
                            },
                            paragraph: {
                                fontSize: 16,
                                colorMode: "single",
                                color: "#3c3c3c",
                                colors: [],
                                randomColors: [],
                                randomCount: 3,
                                margin: 1.5
                            },
                            headings: {
                                h1: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 28,
                                    color: "#2c3e50",
                                    bgColor: "#f8f9fa",
                                    border: false
                                },
                                h2: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 22,
                                    color: "#34495e",
                                    borderColor: "#e0e0e0"
                                },
                                h3: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: "",
                                    fontSize: 18,
                                    color: "#7f8c8d"
                                }
                            },
                            emphasis: {
                                strong: {
                                    colorMode: "single",
                                    color: "#2c3e50",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    bgColor: "#f8f9fa",
                                    underline: false
                                },
                                em: {
                                    colorMode: "single",
                                    color: "#7f8c8d",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    keepItalic: true
                                },
                                blockquote: {
                                    colorMode: "single",
                                    color: "#5e5e5e",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    bgColor: "#f9f9f9",
                                    borderColor: "#e0e0e0"
                                },
                                list: {
                                    colorMode: "single",
                                    color: "#3c3c3c",
                                    colors: [],
                                    randomColors: [],
                                    randomCount: 3,
                                    markerColor: "#95a5a6",
                                    bold: false
                                }
                            },
                            code: {
                                inlineColor: "#e67e22",
                                inlineBgColor: "#f9f9f9",
                                blockTheme: "prism"
                            },
                            other: {
                                linkColor: "#3498db",
                                hrStyle: "solid",
                                hrColor: "#e0e0e0"
                            },
                            templates: {
                                top: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: ""
                                },
                                bottom: {
                                    useTemplate: false,
                                    templateContent: "",
                                    templateName: ""
                                }
                            }
                        },
                        timestamp: new Date().toISOString()
                    }
                };
                
                // 自动加载预设排版.json中的预设
                async function loadExternalTemplates() {
                    try {
                        // 首先尝试加载同目录下的预设排版.json
                        const response = await fetch('./index.json');
                        if (response.ok) {
                            const externalTemplates = await response.json();
                            
                            // 将外部模板转换为内置模板格式
                            Object.keys(externalTemplates).forEach(templateName => {
                                const template = externalTemplates[templateName];
                                builtInTemplates[templateName] = {
                                    type: "built-in",
                                    description: template.description || `${templateName}风格设计`,
                                    styleConfig: template.styleConfig,
                                    timestamp: template.timestamp || new Date().toISOString()
                                };
                            });
                            
                            console.log(`✅ 成功加载 ${Object.keys(externalTemplates).length} 个外部排版预设`);
                            
                            // 显示加载的模板名称
                            const templateNames = Object.keys(externalTemplates);
                            console.log('📋 已加载的模板:', templateNames.join(', '));
                            
                        } else {
                            console.warn('⚠️ 无法加载同目录下的预设排版.json文件，尝试根目录路径');
                            
                            // 如果排版工具目录下没有，尝试根目录
                            try {
                                const rootResponse = await fetch('./index.json');
                                if (rootResponse.ok) {
                                    const externalTemplates = await rootResponse.json();
                                    
                                    // 将外部模板转换为内置模板格式
                                    Object.keys(externalTemplates).forEach(templateName => {
                                        const template = externalTemplates[templateName];
                                        builtInTemplates[templateName] = {
                                            type: "built-in",
                                            description: template.description || `${templateName}风格设计`,
                                            styleConfig: template.styleConfig,
                                            timestamp: template.timestamp || new Date().toISOString()
                                        };
                                    });
                                    
                                    console.log(`✅ 成功从根目录加载 ${Object.keys(externalTemplates).length} 个外部排版预设`);
                                } else {
                                    console.warn('⚠️ 根目录下也没有 index.json 文件，使用默认模板');
                                }
                            } catch(rootError) {
                                console.warn('❌ 根目录加载失败:', rootError.message);
                            }
                        }
                    } catch (error) {
                        console.warn('❌ 加载外部模板时出错:', error.message);
                        // 尝试从根目录位置加载
                        try {
                            const fallbackResponse = await fetch('./index.json');
                            if (fallbackResponse.ok) {
                                const externalTemplates = await fallbackResponse.json();
                                
                                // 将外部模板转换为内置模板格式
                                Object.keys(externalTemplates).forEach(templateName => {
                                    const template = externalTemplates[templateName];
                                    builtInTemplates[templateName] = {
                                        type: "built-in",
                                        description: template.description || `${templateName}风格设计`,
                                        styleConfig: template.styleConfig,
                                        timestamp: template.timestamp || new Date().toISOString()
                                    };
                                });
                                
                                console.log(`✅ 成功加载 ${Object.keys(externalTemplates).length} 个外部排版预设（备用路径）`);
                            } else {
                                console.warn('⚠️ 所有路径均无法加载 index.json 文件，使用默认模板');
                            }
                        } catch(fallbackError) {
                            console.warn('❌ 备用路径加载也失败:', fallbackError.message);
                        }
                    } finally {
                        // 设置最终的模板列表
                        savedTemplates = builtInTemplates;
                        updateTemplateList();
                        updateBatchTemplateList();
                        
                        // 在页面加载时应用第一个筛选模板（如果有）
                        setTimeout(() => {
                            const templateNames = Object.keys(savedTemplates);
                            if (templateNames.length > 3) { // 如果有超过基本模板的模板
                                // 找到第一个非默认模板
                                const nonDefaultTemplates = templateNames.filter(name => 
                                    !['深色专业', '多彩活泼', '优雅简约'].includes(name));
                                
                                if (nonDefaultTemplates.length > 0) {
                                    console.log('🔄 自动应用筛选模板:', nonDefaultTemplates[0]);
                                    // 使用应用模板函数
                                    applyTemplate(nonDefaultTemplates[0]);
                                }
                            }
                        }, 1000); // 延迟1秒，确保界面已完全加载
                    }
                }
                
                // 执行异步加载
                loadExternalTemplates();
            }
            
            // 初始化可拖拽的颜色列表
            function initializeSortableLists() {
                const sortableElements = [
                    document.getElementById('p-colors-list'),
                    document.getElementById('strong-colors-list'),
                    document.getElementById('em-colors-list'),
                    document.getElementById('blockquote-colors-list'),
                    document.getElementById('list-colors-list')
                ];
                
                sortableElements.forEach(el => {
                    if (el) {
                        new Sortable(el, {
                            animation: 150,
                            ghostClass: 'sortable-ghost',
                            onEnd: function(evt) {
                                const type = el.id.split('-')[0];
                                updateColorOrderAfterDrag(type);
                            }
                        });
                    }
                });
            }
            
            // 添加颜色到列表
            function addColor(type) {
                const color = getRandomColor();
                
                // 获取相应的配置对象和DOM元素
                let configObj, colorsList;
                switch(type) {
                    case 'p':
                        configObj = styleConfig.paragraph;
                        colorsList = document.getElementById('p-colors-list');
                        break;
                    case 'strong':
                        configObj = styleConfig.emphasis.strong;
                        colorsList = document.getElementById('strong-colors-list');
                        break;
                    case 'em':
                        configObj = styleConfig.emphasis.em;
                        colorsList = document.getElementById('em-colors-list');
                        break;
                    case 'blockquote':
                        configObj = styleConfig.emphasis.blockquote;
                        colorsList = document.getElementById('blockquote-colors-list');
                        break;
                    case 'list':
                        configObj = styleConfig.emphasis.list;
                        colorsList = document.getElementById('list-colors-list');
                        break;
                }
                
                if (!configObj || !colorsList) return;
                
                // 添加到配置对象
                if (!configObj.colors) configObj.colors = [];
                configObj.colors.push(color);
                
                // 添加到DOM
                const colorItem = document.createElement('div');
                colorItem.className = 'flex items-center justify-between gap-2 p-1 bg-white dark:bg-gray-700 rounded border dark:border-gray-600';
                colorItem.dataset.color = color;
                colorItem.innerHTML = `
                    <div class="flex items-center gap-2 flex-1">
                        <div class="w-6 h-6 rounded" style="background-color: ${color}"></div>
                        <input type="text" value="${color}" class="flex-1 p-1 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                    </div>
                    <button class="remove-color text-red-500 hover:text-red-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 20 20" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
                
                // 绑定颜色输入变更事件
                const colorInput = colorItem.querySelector('input');
                colorInput.addEventListener('input', (e) => {
                    const newColor = e.target.value;
                    const index = Array.from(colorsList.children).indexOf(colorItem);
                    if (index !== -1) {
                        configObj.colors[index] = newColor;
                        colorItem.querySelector('div.w-6').style.backgroundColor = newColor;
                        colorItem.dataset.color = newColor;
                        updatePreview();
                    }
                });
                
                // 绑定删除按钮事件
                const removeBtn = colorItem.querySelector('.remove-color');
                removeBtn.addEventListener('click', () => {
                    const index = Array.from(colorsList.children).indexOf(colorItem);
                    if (index !== -1) {
                        configObj.colors.splice(index, 1);
                        colorsList.removeChild(colorItem);
                        updatePreview();
                    }
                });
                
                colorsList.appendChild(colorItem);
                updatePreview();
            }
            
            // 更新颜色顺序（拖动后）
            function updateColorOrderAfterDrag(type) {
                let configObj, colorsList;
                switch(type) {
                    case 'p':
                        configObj = styleConfig.paragraph;
                        colorsList = document.getElementById('p-colors-list');
                        break;
                    case 'strong':
                        configObj = styleConfig.emphasis.strong;
                        colorsList = document.getElementById('strong-colors-list');
                        break;
                    case 'em':
                        configObj = styleConfig.emphasis.em;
                        colorsList = document.getElementById('em-colors-list');
                        break;
                    case 'blockquote':
                        configObj = styleConfig.emphasis.blockquote;
                        colorsList = document.getElementById('blockquote-colors-list');
                        break;
                    case 'list':
                        configObj = styleConfig.emphasis.list;
                        colorsList = document.getElementById('list-colors-list');
                        break;
                }
                
                if (!configObj || !colorsList) return;
                
                // 更新配置中的颜色顺序
                const newColors = Array.from(colorsList.children).map(item => item.dataset.color);
                configObj.colors = newColors;
                
                updatePreview();
            }
            
            // 生成随机颜色组
            function generateRandomColors(type) {
                let configObj, colorsContainer, countInput;
                switch(type) {
                    case 'p':
                        configObj = styleConfig.paragraph;
                        colorsContainer = document.getElementById('p-random-colors');
                        countInput = document.getElementById('p-random-count');
                        break;
                    case 'strong':
                        configObj = styleConfig.emphasis.strong;
                        colorsContainer = document.getElementById('strong-random-colors');
                        countInput = document.getElementById('strong-random-count');
                        break;
                    case 'em':
                        configObj = styleConfig.emphasis.em;
                        colorsContainer = document.getElementById('em-random-colors');
                        countInput = document.getElementById('em-random-count');
                        break;
                    case 'blockquote':
                        configObj = styleConfig.emphasis.blockquote;
                        colorsContainer = document.getElementById('blockquote-random-colors');
                        countInput = document.getElementById('blockquote-random-count');
                        break;
                    case 'list':
                        configObj = styleConfig.emphasis.list;
                        colorsContainer = document.getElementById('list-random-colors');
                        countInput = document.getElementById('list-random-count');
                        break;
                }
                
                if (!configObj || !colorsContainer || !countInput) return;
                
                // 清空现有颜色
                colorsContainer.innerHTML = '';
                
                // 获取颜色数量
                const count = parseInt(countInput.value) || 3;
                configObj.randomCount = count;
                
                // 生成随机颜色
                configObj.randomColors = [];
                for (let i = 0; i < count; i++) {
                    const color = getRandomColor();
                    configObj.randomColors.push(color);
                    
                    // 添加到DOM
                    const colorItem = document.createElement('div');
                    colorItem.className = 'w-8 h-8 rounded border dark:border-gray-600';
                    colorItem.style.backgroundColor = color;
                    colorItem.title = color;
                    colorsContainer.appendChild(colorItem);
                }
                
                updatePreview();
            }

            // 应用样式按钮
            document.getElementById('apply-styles').addEventListener('click', () => {
                updatePreview();
                showNotification('样式已应用');
            });

            // 重置样式按钮
            document.getElementById('reset-styles').addEventListener('click', () => {
                if (confirm('确定要重置所有样式设置吗？')) {
                    location.reload();
                }
            });

            // 复制HTML按钮
            copyHtmlBtn.addEventListener('click', () => {
                const content = articleContent.value;
                
                // 将Markdown转换为HTML
                let htmlContent = marked.parse(content);
                
                // 应用顶部模板
                let topContent = '';
                if (styleConfig.templates.top.useTemplate && styleConfig.templates.top.templateContent) {
                    topContent = styleConfig.templates.top.templateContent;
                }
                
                // 应用底部模板
                let bottomContent = '';
                if (styleConfig.templates.bottom.useTemplate && styleConfig.templates.bottom.templateContent) {
                    bottomContent = styleConfig.templates.bottom.templateContent;
                }
                
                // 处理标题模板
                if (styleConfig.headings.h2.useTemplate && styleConfig.headings.h2.templateContent) {
                    // 查找所有h2标签并替换为模板
                    const h2Regex = /<h2[^>]*>(.*?)<\/h2>/g;
                    htmlContent = htmlContent.replace(h2Regex, (match, text) => {
                        let template = styleConfig.headings.h2.templateContent;
                        return template.replace('{h2_text}', text);
                    });
                }
                
                // 生成CSS
                const css = generateCSS();
                
                // 创建完整HTML
                const fullHtml = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <style>
                            ${css}
                        </style>
                    </head>
                    <body>
                        <div class="wechat-article">
                            <div class="article-content">
                                ${topContent}
                                ${htmlContent}
                                ${bottomContent}
                            </div>
                        </div>
                    </body>
                    </html>
                `;
                
                copyToClipboard(fullHtml);
                showNotification('HTML代码已复制到剪贴板');
            });

            // 复制CSS按钮
            copyWechatBtn.addEventListener('click', () => {
                // 获取预览区内容
                const preview = document.getElementById('preview-container');
                if (!preview) {
                    showNotification('未找到预览区', 'error');
                    return;
                }
                // 复制富文本到剪贴板
                const html = preview.innerHTML;
                // 使用Clipboard API
                if (navigator.clipboard && window.ClipboardItem) {
                    const blob = new Blob([html], { type: 'text/html' });
                    const data = [new window.ClipboardItem({ 'text/html': blob })];
                    navigator.clipboard.write(data).then(() => {
                        showNotification('已复制，可直接粘贴到公众号编辑器');
                    }, () => {
                        showNotification('复制失败，请手动全选复制', 'error');
                    });
                } else {
                    // 兼容老浏览器
                    const textarea = document.createElement('textarea');
                    textarea.value = html;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showNotification('已复制（兼容模式），如样式丢失请手动全选复制');
                }
            });

            // 下载HTML按钮
            downloadHtmlBtn.addEventListener('click', () => {
                const title = articleTitle.value || '未命名文章';
                const content = articleContent.value;
                
                // 将Markdown转换为HTML
                let htmlContent = marked.parse(content);
                
                // 应用顶部模板
                let topContent = '';
                if (styleConfig.templates.top.useTemplate && styleConfig.templates.top.templateContent) {
                    topContent = styleConfig.templates.top.templateContent;
                }
                
                // 应用底部模板
                let bottomContent = '';
                if (styleConfig.templates.bottom.useTemplate && styleConfig.templates.bottom.templateContent) {
                    bottomContent = styleConfig.templates.bottom.templateContent;
                }
                
                // 处理标题模板
                if (styleConfig.headings.h2.useTemplate && styleConfig.headings.h2.templateContent) {
                    // 查找所有h2标签并替换为模板
                    const h2Regex = /<h2[^>]*>(.*?)<\/h2>/g;
                    htmlContent = htmlContent.replace(h2Regex, (match, text) => {
                        let template = styleConfig.headings.h2.templateContent;
                        return template.replace('{h2_text}', text);
                    });
                }
                
                // 生成CSS
                const css = generateCSS();
                
                // 创建完整HTML
                const fullHtml = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>${title}</title>
                        <style>
                            ${css}
                        </style>
                    </head>
                    <body>
                        <div class="wechat-article">
                            <div class="article-content">
                                ${topContent}
                                ${htmlContent}
                                ${bottomContent}
                            </div>
                        </div>
                    </body>
                    </html>
                `;
                
                // 创建Blob并下载
                const blob = new Blob([fullHtml], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${title}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('HTML文件已下载');
            });

            // 复制到剪贴板工具函数
            function copyToClipboard(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }

            // 显示通知
            function showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                
                let bgColor;
                switch(type) {
                    case 'error':
                        bgColor = 'bg-red-500';
                        break;
                    case 'warning':
                        bgColor = 'bg-yellow-500';
                        break;
                    case 'info':
                        bgColor = 'bg-blue-500';
                        break;
                    case 'success':
                    default:
                        bgColor = 'bg-green-500';
                }
                
                notification.className = `fixed bottom-4 right-4 ${bgColor} text-white px-4 py-2 rounded-md shadow-lg z-50`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 500);
                }, 3000);
            }

            // 保存模板
            saveTemplateBtn.addEventListener('click', () => {
                const name = templateName.value.trim();
                if (!name) {
                    alert('请输入模板名称');
                    return;
                }
                
                savedTemplates[name] = {
                    type: "custom",
                    description: templateDesc.value || "",
                    styleConfig: JSON.parse(JSON.stringify(styleConfig)),
                        timestamp: new Date().toISOString()
                };
                
                templateName.value = '';
                templateDesc.value = '';
                updateTemplateList();
                updateBatchTemplateList();
                showNotification(`模板"${name}"已保存`);
            });

            // 导出模板库按钮事件
            document.getElementById('export-templates').addEventListener('click', () => {
                // 创建只包含自定义模板的对象
                const customTemplates = {};
                for (const [name, data] of Object.entries(savedTemplates)) {
                    if (data.type === "custom") {
                        customTemplates[name] = data;
                    }
                }
                
                const templatesData = JSON.stringify(customTemplates, null, 2);
                const blob = new Blob([templatesData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `公众号文章排版工具_模板库_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('模板库已导出');
            });
            
            // 导入模板库按钮事件
            document.getElementById('import-templates').addEventListener('click', () => {
                const input = document.getElementById('template-import-input');
                input.value = '';
                input.click();
            });
            
            // 导入模板文件事件处理
            document.getElementById('template-import-input').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const importedTemplates = JSON.parse(event.target.result);
                        
                        // 验证导入的数据格式
                        let isValid = true;
                        let importCount = 0;
                        
                        for (const [name, data] of Object.entries(importedTemplates)) {
                            if (!data.styleConfig) {
                                isValid = false;
                                break;
                            }
                            
                            // 确保导入的模板有必要字段，并设置为自定义模板
                            data.type = "custom";
                            if (!data.timestamp) data.timestamp = new Date().toISOString();
                            if (!data.description) data.description = '';
                            
                            // 如果已存在同名模板，确认是否覆盖
                            if (savedTemplates[name] && !confirm(`已存在名为"${name}"的模板，是否覆盖？`)) {
                                continue;
                            }
                            
                            savedTemplates[name] = data;
                            importCount++;
                        }
                        
                        if (!isValid) {
                            alert('导入的模板文件格式无效，请确认是否为有效的模板库文件');
                            return;
                        }
                        
                        updateTemplateList();
                        updateBatchTemplateList();
                        populateTemplateCheckboxes();
                        
                        showNotification(`成功导入 ${importCount} 个模板`);
                    } catch (error) {
                        alert('导入模板时发生错误：' + error.message);
                    }
                };
                reader.readAsText(file);
            });

            // 应用指定名称的模板
            function applyTemplate(name) {
                if (savedTemplates[name]) {
                    styleConfig = JSON.parse(JSON.stringify(savedTemplates[name].styleConfig));
                    updateUIFromConfig();
                    updatePreview();
                    showNotification(`已应用模板"${name}"`);
                    return true;
                } else {
                    console.warn(`模板"${name}"不存在`);
                    return false;
                }
            }
            
            // 更新模板列表
            function updateTemplateList() {
                templateList.innerHTML = '';
                
                if (Object.keys(savedTemplates).length === 0) {
                    templateList.innerHTML = '<div class="text-gray-500 italic dark:text-gray-400">暂无保存的模板</div>';
                    return;
                }
                
                const filter = document.getElementById('template-filter').value;
                
                for (const [name, data] of Object.entries(savedTemplates)) {
                    // 筛选模板
                    if (filter !== 'all' && data.type !== filter) continue;
                    
                    const date = new Date(data.timestamp);
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                    
                    const templateItem = document.createElement('div');
                    templateItem.className = 'bg-white dark:bg-gray-700 p-3 rounded-md border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow duration-200';
                    
                    // 为不同类型模板添加不同样式
                    if (data.type === 'built-in') {
                        templateItem.classList.add('border-l-4', 'border-l-primary');
                    }
                    
                    templateItem.innerHTML = `
                        <div class="flex flex-col space-y-2">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-medium text-lg">${name}</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        ${data.type === 'built-in' ? 
                                            '<span class="bg-primary text-white px-1 py-0.5 rounded text-xs mr-1">内置</span>' : 
                                            '<span class="bg-gray-200 dark:bg-gray-600 px-1 py-0.5 rounded text-xs mr-1">自定义</span>'
                                        }
                                        ${formattedDate}
                                    </div>
                                </div>
                                <div class="flex gap-1">
                                    <button class="apply-template bg-primary text-white p-1 rounded-md text-sm hover:bg-primary-dark" title="应用此模板" data-name="${name}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </button>
                                    ${data.type !== 'built-in' ? `
                                    <button class="delete-template bg-red-500 text-white p-1 rounded-md text-sm hover:bg-red-600" title="删除此模板" data-name="${name}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                            ${data.description ? `<p class="text-sm text-gray-600 dark:text-gray-300">${data.description}</p>` : ''}
                            <div class="flex flex-wrap gap-1 mt-1">
                                ${data.styleConfig.headings.h1.color ? 
                                    `<div class="w-5 h-5 rounded-full" style="background-color: ${data.styleConfig.headings.h1.color}" title="标题颜色"></div>` : ''
                                }
                                ${data.styleConfig.emphasis.strong.color ? 
                                    `<div class="w-5 h-5 rounded-full" style="background-color: ${data.styleConfig.emphasis.strong.color}" title="强调颜色"></div>` : ''
                                }
                                ${data.styleConfig.paragraph.colorMode === 'multiple' && data.styleConfig.paragraph.colors.length > 0 ? 
                                    data.styleConfig.paragraph.colors.map(color => 
                                        `<div class="w-5 h-5 rounded-full" style="background-color: ${color}" title="段落颜色"></div>`
                                    ).join('') : 
                                    data.styleConfig.paragraph.color ? 
                                        `<div class="w-5 h-5 rounded-full" style="background-color: ${data.styleConfig.paragraph.color}" title="段落颜色"></div>` : ''
                                }
                            </div>
                        </div>
                    `;
                    
                    templateList.appendChild(templateItem);
                }
                
                // 绑定模板操作按钮事件
                document.querySelectorAll('.apply-template').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const name = btn.dataset.name;
                        applyTemplate(name);
                    });
                });
                
                document.querySelectorAll('.delete-template').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const name = btn.dataset.name;
                        if (confirm(`确定要删除模板"${name}"吗？`)) {
                            delete savedTemplates[name];
                            updateTemplateList();
                            updateBatchTemplateList();
                            populateTemplateCheckboxes();
                            showNotification(`模板"${name}"已删除`);
                        }
                    });
                });
                
                // 如果没有模板满足筛选条件
                if (templateList.children.length === 0) {
                    templateList.innerHTML = '<div class="text-gray-500 italic dark:text-gray-400">没有符合条件的模板</div>';
                }
            }
            
            // 模板筛选器事件
            document.getElementById('template-filter').addEventListener('change', updateTemplateList);
            
            // 刷新模板按钮
            document.getElementById('refresh-templates').addEventListener('click', updateTemplateList);

            // 更新批量处理模板下拉列表
            function updateBatchTemplateList() {
                const batchTemplate = document.getElementById('batch-template');
                batchTemplate.innerHTML = '<option value="">使用当前样式</option>';
                
                for (const name of Object.keys(savedTemplates)) {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    batchTemplate.appendChild(option);
                }
            }

            // 从配置更新UI
            function updateUIFromConfig() {
                // 更新全局设置
                centerContent.checked = styleConfig.global.centerContent;
                
                if (styleConfig.global.font) {
                    const matchingOption = Array.from(globalFont.options).find(option => option.value === styleConfig.global.font);
                    if (matchingOption) {
                        globalFont.value = styleConfig.global.font;
                        customFontContainer.classList.add('hidden');
                    } else {
                        globalFont.value = 'custom';
                        customFontContainer.classList.remove('hidden');
                        customFont.value = styleConfig.global.font;
                    }
                }
                
                lineHeight.value = styleConfig.global.lineHeight;
                lineHeightValue.textContent = styleConfig.global.lineHeight;
                letterSpacing.value = styleConfig.global.letterSpacing;
                letterSpacingValue.textContent = styleConfig.global.letterSpacing + 'em';
                
                // 更新段落设置
                pFontSize.value = styleConfig.paragraph.fontSize;
                pFontSizeValue.textContent = styleConfig.paragraph.fontSize + 'px';
                pColor.value = styleConfig.paragraph.color;
                pColorHex.value = styleConfig.paragraph.color;
                pMargin.value = styleConfig.paragraph.margin;
                pMarginValue.textContent = styleConfig.paragraph.margin + 'em';
                pColorMode.value = styleConfig.paragraph.colorMode;
                document.querySelectorAll('.p-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`p-color-${styleConfig.paragraph.colorMode}`).classList.remove('hidden');
                
                // 更新段落颜色列表
                updateColorList('p', styleConfig.paragraph.colors);
                updateRandomColorDisplay('p', styleConfig.paragraph.randomColors);
                document.getElementById('p-random-count').value = styleConfig.paragraph.randomCount || 3;
                
                // 更新标题设置
                document.getElementById('h1-font-size').value = styleConfig.headings.h1.fontSize;
                document.getElementById('h1-font-size-value').textContent = styleConfig.headings.h1.fontSize + 'px';
                document.getElementById('h1-color').value = styleConfig.headings.h1.color;
                document.getElementById('h1-color-hex').value = styleConfig.headings.h1.color;
                document.getElementById('h1-bg-color').value = styleConfig.headings.h1.bgColor;
                document.getElementById('h1-bg-color-hex').value = styleConfig.headings.h1.bgColor;
                document.getElementById('h1-border').checked = styleConfig.headings.h1.border;
                
                document.getElementById('h2-font-size').value = styleConfig.headings.h2.fontSize;
                document.getElementById('h2-font-size-value').textContent = styleConfig.headings.h2.fontSize + 'px';
                document.getElementById('h2-color').value = styleConfig.headings.h2.color;
                document.getElementById('h2-color-hex').value = styleConfig.headings.h2.color;
                document.getElementById('h2-border-color').value = styleConfig.headings.h2.borderColor;
                document.getElementById('h2-border-color-hex').value = styleConfig.headings.h2.borderColor;
                
                document.getElementById('h3-font-size').value = styleConfig.headings.h3.fontSize;
                document.getElementById('h3-font-size-value').textContent = styleConfig.headings.h3.fontSize + 'px';
                document.getElementById('h3-color').value = styleConfig.headings.h3.color;
                document.getElementById('h3-color-hex').value = styleConfig.headings.h3.color;
                
                // 更新标题模板信息
                if (styleConfig.headings.h1.useTemplate) {
                    document.getElementById('h1-template-info').classList.remove('hidden');
                    document.getElementById('h1-template-name').textContent = styleConfig.headings.h1.templateName || "已自定义";
                    document.getElementById('h1-standard-settings').classList.add('hidden');
                } else {
                    document.getElementById('h1-template-info').classList.add('hidden');
                    document.getElementById('h1-standard-settings').classList.remove('hidden');
                }
                
                if (styleConfig.headings.h2.useTemplate) {
                    document.getElementById('h2-template-info').classList.remove('hidden');
                    document.getElementById('h2-template-name').textContent = styleConfig.headings.h2.templateName || "已自定义";
                    document.getElementById('h2-standard-settings').classList.add('hidden');
                } else {
                    document.getElementById('h2-template-info').classList.add('hidden');
                    document.getElementById('h2-standard-settings').classList.remove('hidden');
                }
                
                if (styleConfig.headings.h3.useTemplate) {
                    document.getElementById('h3-template-info').classList.remove('hidden');
                    document.getElementById('h3-template-name').textContent = styleConfig.headings.h3.templateName || "已自定义";
                    document.getElementById('h3-standard-settings').classList.add('hidden');
                } else {
                    document.getElementById('h3-template-info').classList.add('hidden');
                    document.getElementById('h3-standard-settings').classList.remove('hidden');
                }
                
                // 更新强调设置 - 粗体
                document.getElementById('strong-color').value = styleConfig.emphasis.strong.color;
                document.getElementById('strong-color-hex').value = styleConfig.emphasis.strong.color;
                document.getElementById('strong-bg-color').value = styleConfig.emphasis.strong.bgColor;
                document.getElementById('strong-bg-color-hex').value = styleConfig.emphasis.strong.bgColor;
                document.getElementById('strong-underline').checked = styleConfig.emphasis.strong.underline;
                strongColorMode.value = styleConfig.emphasis.strong.colorMode;
                document.querySelectorAll('.strong-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`strong-color-${styleConfig.emphasis.strong.colorMode}`).classList.remove('hidden');
                updateColorList('strong', styleConfig.emphasis.strong.colors);
                updateRandomColorDisplay('strong', styleConfig.emphasis.strong.randomColors);
                document.getElementById('strong-random-count').value = styleConfig.emphasis.strong.randomCount || 3;
                
                // 更新强调设置 - 斜体
                document.getElementById('em-color').value = styleConfig.emphasis.em.color;
                document.getElementById('em-color-hex').value = styleConfig.emphasis.em.color;
                document.getElementById('em-keep-italic').checked = styleConfig.emphasis.em.keepItalic;
                emColorMode.value = styleConfig.emphasis.em.colorMode;
                document.querySelectorAll('.em-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`em-color-${styleConfig.emphasis.em.colorMode}`).classList.remove('hidden');
                updateColorList('em', styleConfig.emphasis.em.colors);
                updateRandomColorDisplay('em', styleConfig.emphasis.em.randomColors);
                document.getElementById('em-random-count').value = styleConfig.emphasis.em.randomCount || 3;
                
                // 更新强调设置 - 引用
                document.getElementById('blockquote-color').value = styleConfig.emphasis.blockquote.color;
                document.getElementById('blockquote-color-hex').value = styleConfig.emphasis.blockquote.color;
                document.getElementById('blockquote-bg-color').value = styleConfig.emphasis.blockquote.bgColor;
                document.getElementById('blockquote-bg-color-hex').value = styleConfig.emphasis.blockquote.bgColor;
                document.getElementById('blockquote-border-color').value = styleConfig.emphasis.blockquote.borderColor;
                document.getElementById('blockquote-border-color-hex').value = styleConfig.emphasis.blockquote.borderColor;
                blockquoteColorMode.value = styleConfig.emphasis.blockquote.colorMode;
                document.querySelectorAll('.blockquote-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`blockquote-color-${styleConfig.emphasis.blockquote.colorMode}`).classList.remove('hidden');
                updateColorList('blockquote', styleConfig.emphasis.blockquote.colors);
                updateRandomColorDisplay('blockquote', styleConfig.emphasis.blockquote.randomColors);
                document.getElementById('blockquote-random-count').value = styleConfig.emphasis.blockquote.randomCount || 3;
                
                // 更新强调设置 - 列表
                document.getElementById('list-color').value = styleConfig.emphasis.list.color;
                document.getElementById('list-color-hex').value = styleConfig.emphasis.list.color;
                document.getElementById('list-marker-color').value = styleConfig.emphasis.list.markerColor;
                document.getElementById('list-marker-color-hex').value = styleConfig.emphasis.list.markerColor;
                document.getElementById('list-bold').checked = styleConfig.emphasis.list.bold;
                listColorMode.value = styleConfig.emphasis.list.colorMode;
                document.querySelectorAll('.list-color-group').forEach(el => el.classList.add('hidden'));
                document.getElementById(`list-color-${styleConfig.emphasis.list.colorMode}`).classList.remove('hidden');
                updateColorList('list', styleConfig.emphasis.list.colors);
                updateRandomColorDisplay('list', styleConfig.emphasis.list.randomColors);
                document.getElementById('list-random-count').value = styleConfig.emphasis.list.randomCount || 3;
                
                // 更新代码设置
                document.getElementById('code-color').value = styleConfig.code.inlineColor;
                document.getElementById('code-bg-color').value = styleConfig.code.inlineBgColor;
                document.getElementById('code-block-theme').value = styleConfig.code.blockTheme;
                
                // 更新其他设置
                document.getElementById('link-color').value = styleConfig.other.linkColor;
                document.getElementById('link-color-hex').value = styleConfig.other.linkColor;
                document.getElementById('hr-style').value = styleConfig.other.hrStyle;
                document.getElementById('hr-color').value = styleConfig.other.hrColor;
                document.getElementById('hr-color-hex').value = styleConfig.other.hrColor;
                
                // 更新文章顶部和底部模板信息
                if (styleConfig.templates.top.useTemplate) {
                    document.getElementById('top-template-info').classList.remove('hidden');
                    document.getElementById('top-template-name').textContent = styleConfig.templates.top.templateName || "已自定义";
                    document.getElementById('top-template-preview').classList.remove('hidden');
                    document.getElementById('top-template-preview').innerHTML = styleConfig.templates.top.templateContent;
                } else {
                    document.getElementById('top-template-info').classList.add('hidden');
                    document.getElementById('top-template-preview').classList.add('hidden');
                }
                
                if (styleConfig.templates.bottom.useTemplate) {
                    document.getElementById('bottom-template-info').classList.remove('hidden');
                    document.getElementById('bottom-template-name').textContent = styleConfig.templates.bottom.templateName || "已自定义";
                    document.getElementById('bottom-template-preview').classList.remove('hidden');
                    document.getElementById('bottom-template-preview').innerHTML = styleConfig.templates.bottom.templateContent;
                } else {
                    document.getElementById('bottom-template-info').classList.add('hidden');
                    document.getElementById('bottom-template-preview').classList.add('hidden');
                }
            }
            
            // 更新多色列表
            function updateColorList(type, colors) {
                let colorsList;
                switch(type) {
                    case 'p':
                        colorsList = document.getElementById('p-colors-list');
                        break;
                    case 'strong':
                        colorsList = document.getElementById('strong-colors-list');
                        break;
                    case 'em':
                        colorsList = document.getElementById('em-colors-list');
                        break;
                    case 'blockquote':
                        colorsList = document.getElementById('blockquote-colors-list');
                        break;
                    case 'list':
                        colorsList = document.getElementById('list-colors-list');
                        break;
                }
                
                if (!colorsList || !colors) return;
                
                colorsList.innerHTML = '';
                
                colors.forEach((color, index) => {
                    const colorItem = document.createElement('div');
                    colorItem.className = 'flex items-center justify-between gap-2 p-1 bg-white dark:bg-gray-700 rounded border dark:border-gray-600';
                    colorItem.dataset.color = color;
                    colorItem.innerHTML = `
                        <div class="flex items-center gap-2 flex-1">
                            <div class="w-6 h-6 rounded" style="background-color: ${color}"></div>
                            <input type="text" value="${color}" class="flex-1 p-1 text-sm border rounded focus:outline-none focus:ring-1 focus:ring-primary dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <button class="remove-color text-red-500 hover:text-red-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 20 20" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    `;
                    
                    // 绑定事件
                    const colorInput = colorItem.querySelector('input');
                    colorInput.addEventListener('input', (e) => {
                        const newColor = e.target.value;
                        const index = Array.from(colorsList.children).indexOf(colorItem);
                        if (index !== -1) {
                            // 更新对应的配置
                            switch(type) {
                                case 'p':
                                    styleConfig.paragraph.colors[index] = newColor;
                                    break;
                                case 'strong':
                                    styleConfig.emphasis.strong.colors[index] = newColor;
                                    break;
                                case 'em':
                                    styleConfig.emphasis.em.colors[index] = newColor;
                                    break;
                                case 'blockquote':
                                    styleConfig.emphasis.blockquote.colors[index] = newColor;
                                    break;
                                case 'list':
                                    styleConfig.emphasis.list.colors[index] = newColor;
                                    break;
                            }
                            colorItem.querySelector('div.w-6').style.backgroundColor = newColor;
                            colorItem.dataset.color = newColor;
                            updatePreview();
                        }
                    });
                    
                    // 绑定删除按钮事件
                    const removeBtn = colorItem.querySelector('.remove-color');
                    removeBtn.addEventListener('click', () => {
                        const index = Array.from(colorsList.children).indexOf(colorItem);
                        if (index !== -1) {
                            // 更新对应的配置
                            switch(type) {
                                case 'p':
                                    styleConfig.paragraph.colors.splice(index, 1);
                                    break;
                                case 'strong':
                                    styleConfig.emphasis.strong.colors.splice(index, 1);
                                    break;
                                case 'em':
                                    styleConfig.emphasis.em.colors.splice(index, 1);
                                    break;
                                case 'blockquote':
                                    styleConfig.emphasis.blockquote.colors.splice(index, 1);
                                    break;
                                case 'list':
                                    styleConfig.emphasis.list.colors.splice(index, 1);
                                    break;
                            }
                            colorsList.removeChild(colorItem);
                            updatePreview();
                        }
                    });
                    
                    colorsList.appendChild(colorItem);
                });
            }
            
            // 更新随机颜色显示
            function updateRandomColorDisplay(type, colors) {
                let colorsContainer;
                switch(type) {
                    case 'p':
                        colorsContainer = document.getElementById('p-random-colors');
                        break;
                    case 'strong':
                        colorsContainer = document.getElementById('strong-random-colors');
                        break;
                    case 'em':
                        colorsContainer = document.getElementById('em-random-colors');
                        break;
                    case 'blockquote':
                        colorsContainer = document.getElementById('blockquote-random-colors');
                        break;
                    case 'list':
                        colorsContainer = document.getElementById('list-random-colors');
                        break;
                }
                
                if (!colorsContainer || !colors) return;
                
                colorsContainer.innerHTML = '';
                
                colors.forEach(color => {
                    const colorItem = document.createElement('div');
                    colorItem.className = 'w-8 h-8 rounded border dark:border-gray-600';
                    colorItem.style.backgroundColor = color;
                    colorItem.title = color;
                    colorsContainer.appendChild(colorItem);
                });
            }

            // 批量处理开始按钮
            startBatchBtn.addEventListener('click', () => {
                if (selectedFiles.length === 0) {
                    alert('请先选择要处理的文件');
                    return;
                }
                
                if (batchLog) batchLog.innerHTML = ''; // 清空日志
                if (debugMode && debugMode.checked && batchLog) {
                    batchLog.classList.remove('hidden');
                    addLog('开始批量处理', 'info');
                }
                
                // 获取批量处理配置
                const outputFormat = batchOutputFormat.value;
                const outputNamePrefix = batchOutputName.value.trim();
                const shouldZip = batchOutputZip.checked;
                const applyMode = document.querySelector('input[name="template-apply-mode"]:checked').value;
                
                // 获取要应用的模板
                let templatesToApply = [];
                if (applyMode === 'single') {
                    const templateName = document.getElementById('batch-template').value;
                    if (templateName && savedTemplates[templateName]) {
                        templatesToApply = [savedTemplates[templateName].styleConfig];
                        if (debugMode && debugMode.checked) {
                            addLog(`使用单一模板: ${templateName}`, 'info');
                        }
                    } else {
                        templatesToApply = [JSON.parse(JSON.stringify(styleConfig))]; // 使用当前样式的深拷贝
                        if (debugMode && debugMode.checked) {
                            addLog('使用当前样式作为模板', 'info');
                        }
                    }
                } else {
                    // 多模板随机应用
                    updateSelectedTemplates();
                    if (selectedTemplates.length === 0) {
                        alert('请至少选择一个模板');
                        return;
                    }
                    
                    for (const name of selectedTemplates) {
                        if (savedTemplates[name] && savedTemplates[name].styleConfig) {
                            templatesToApply.push(savedTemplates[name].styleConfig);
                        }
                    }
                    
                    if (templatesToApply.length === 0) {
                        // 如果没有有效的模板，使用当前样式
                        templatesToApply = [JSON.parse(JSON.stringify(styleConfig))];
                        if (debugMode && debugMode.checked) {
                            addLog('所选模板无效，使用当前样式作为备用', 'warning');
                        }
                    } else if (debugMode && debugMode.checked) {
                        addLog(`随机应用 ${templatesToApply.length} 个模板: ${selectedTemplates.join(', ')}`, 'info');
                    }
                }
                
                // 开始批量处理
                processBatchFiles(selectedFiles, templatesToApply, outputFormat, outputNamePrefix, shouldZip);
            });

            // 更新异步读取文件函数
            function readFileAsync(file) {
                return new Promise((resolve, reject) => {
                    try {
                        const reader = new FileReader();
                        reader.onload = event => resolve(event.target.result);
                        reader.onerror = error => reject(error);
                        reader.readAsText(file);
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            // 批量处理文件 
            async function processBatchFiles(files, templates, outputFormat, prefix, shouldZip) {
                const batchStatus = document.getElementById('batch-status');
                const batchProgress = document.getElementById('batch-progress');
                const batchTotal = document.getElementById('batch-total');
                const batchProgressBar = document.getElementById('batch-progress-bar');
                
                try {
                    // 显示进度条
                    batchStatus.classList.remove('hidden');
                    batchTotal.textContent = files.length;
                    batchProgress.textContent = '0';
                    batchProgressBar.style.width = '0%';
                    
                    if (files.length === 0) {
                        showNotification('没有找到有效的文件进行处理', 'error');
                        return;
                    }
                    
                    console.log(`开始处理 ${files.length} 个文件...`);
                    const results = [];
                    
                    // 创建ZIP文件（如果需要）
                    let zip = null;
                    if (shouldZip) {
                        console.log('创建JSZip实例...');
                        try {
                            zip = new JSZip();
                            console.log('JSZip实例创建成功');
                        } catch (zipError) {
                            console.error(`JSZip创建失败: ${zipError.message}`);
                            showNotification('创建ZIP文件失败，将单独下载文件', 'warning');
                        }
                    }
                    
                    // 处理每个文件
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        console.log(`处理文件 ${i+1}/${files.length}: ${file.name}`);
                        
                        // 更新进度
                        batchProgress.textContent = i + 1;
                        const percent = Math.round(((i + 1) / files.length) * 100);
                        batchProgressBar.style.width = `${percent}%`;
                        
                        try {
                            // 读取文件内容
                            const content = await readFileAsync(file);
                            if (!content) {
                                console.warn(`文件 ${file.name} 内容为空，跳过`);
                                continue;
                            }
                            
                            console.log(`成功读取文件 ${file.name}`);
                            
                            // 使用原始文件名作为输出文件名 - 仅移除扩展名并清理特殊字符
                            let fileName = file.name.replace(/\.(md|markdown|txt)$/i, '')
                                .replace(/[\\/:*?"<>|]/g, '_');
                            let markdownContent = content;
                            
                            // 从内容中提取标题用于显示，但不替换文件名
                            let title = fileName;
                            const firstLine = content.split('\n')[0];
                            if (firstLine.startsWith('# ')) {
                                // 提取文章标题仅用于内容处理
                                title = firstLine.replace('# ', '');
                                // 不再修改markdownContent，保留完整内容
                                console.log(`从文件中提取到标题(仅用于显示): ${title}`);
                            }
                            
                            // 不限制文件名长度，保持原始文件名
                            
                            // 随机选择一个模板
                            const templateIndex = Math.floor(Math.random() * templates.length);
                            const selectedTemplate = templates[templateIndex];
                            
                            // 处理文件
                            console.log(`应用模板处理 ${file.name}`);
                            const processedContent = processFile(title, markdownContent, selectedTemplate, outputFormat);
                            if (!processedContent) {
                                console.warn(`处理后的文件 ${file.name} 内容为空，跳过`);
                                continue;
                            }
                            
                            // 创建输出文件名 - 使用原始文件名，而不是文章标题
                            let outputFileName = '';
                            if (prefix) {
                                outputFileName = `${prefix}_${fileName}`;
                            } else {
                                outputFileName = fileName;
                            }
                            
                            // 添加文件扩展名
                            switch (outputFormat) {
                                case 'html':
                                    outputFileName += '.html';
                                    break;
                                case 'md':
                                    outputFileName += '.md';
                                    break;
                                case 'txt':
                                    outputFileName += '.txt';
                                    break;
                            }
                            
                            // 保存结果
                            results.push({
                                fileName: outputFileName,
                                content: processedContent
                            });
                            
                            // 添加到ZIP（如果需要）
                            if (zip) {
                                console.log(`添加文件到ZIP: ${outputFileName}`);
                                zip.file(outputFileName, processedContent);
                            }
                        } catch (fileError) {
                            console.error(`处理文件 ${file.name} 时出错: ${fileError.message}`);
                            showNotification(`处理文件 ${file.name} 时出错`, 'warning');
                            continue; // 继续处理下一个文件
                        }
                    }
                    
                    // 检查结果
                    if (results.length === 0) {
                        showNotification('处理结果为空，没有生成有效的文件', 'error');
                        return;
                    }
                    
                    console.log(`成功处理 ${results.length} 个文件，准备下载...`);
                    
                    // 下载处理结果
                    if (shouldZip && zip) {
                        // 生成并下载ZIP文件
                        console.log('正在生成ZIP文件...');
                        
                        try {
                            const blob = await zip.generateAsync({
                                type: 'blob',
                                compression: 'DEFLATE',
                                compressionOptions: { level: 5 }
                            });
                            
                            if (!blob || blob.size === 0) {
                                console.error('生成的ZIP文件为空！');
                                showNotification('生成的ZIP文件为空，尝试单独下载文件', 'error');
                                
                                // 回退到单独下载每个文件
                                for (const result of results) {
                                    try {
                                        const singleBlob = new Blob([result.content], {
                                            type: outputFormat === 'html' ? 'text/html' : 'text/plain'
                                        });
                                        const url = URL.createObjectURL(singleBlob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = result.fileName;
                                        document.body.appendChild(a);
                                        a.click();
                                        setTimeout(() => {
                                            URL.revokeObjectURL(url);
                                            document.body.removeChild(a);
                                        }, 100);
                                        await new Promise(resolve => setTimeout(resolve, 300));
                                    } catch (err) {
                                        console.error(`单独下载 ${result.fileName} 失败: ${err.message}`);
                                    }
                                }
                                return;
                            }
                            
                            console.log(`ZIP文件生成成功，大小: ${(blob.size / 1024).toFixed(2)} KB，开始下载...`);
                            const zipFileName = `公众号文章排版批量处理_${new Date().toISOString().replace(/[:.]/g, '-')}.zip`;
                            
                            try {
                                // 首先尝试使用 saveAs 函数
                                saveAs(blob, zipFileName);
                                console.log('ZIP文件下载已开始');
                            } catch (saveError) {
                                console.warn(`saveAs 下载失败: ${saveError.message}，尝试使用备用方法`);
                                
                                // 备用下载方法
                                try {
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = zipFileName;
                                    document.body.appendChild(a);
                                    a.click();
                                    
                                    // 延迟清理
                                    setTimeout(() => {
                                        document.body.removeChild(a);
                                        URL.revokeObjectURL(url);
                                        console.log('ZIP文件下载链接已释放');
                                    }, 1000);
                                } catch (downloadError) {
                                    console.error(`备用下载方法失败: ${downloadError.message}`);
                                    showNotification('下载失败，请查看控制台获取详细信息', 'error');
                                }
                            }
                        } catch (zipGenError) {
                            console.error(`ZIP文件生成失败: ${zipGenError.message}`);
                            showNotification(`ZIP文件生成失败，尝试单独下载文件`, 'error');
                            
                            // 如果ZIP失败，尝试单独下载文件
                            if (confirm('ZIP文件生成失败，是否尝试单独下载每个文件？')) {
                                console.log('尝试单独下载文件...');
                                for (const result of results) {
                                    try {
                                        const blob = new Blob([result.content], {
                                            type: outputFormat === 'html' ? 'text/html' : 'text/plain'
                                        });
                                        saveAs(blob, result.fileName);
                                        await new Promise(resolve => setTimeout(resolve, 300));
                                    } catch (downloadError) {
                                        console.error(`文件 ${result.fileName} 下载失败: ${downloadError.message}`);
                                    }
                                }
                            }
                        }
                    } else {
                        // 单独下载每个文件
                        console.log('开始单独下载每个文件...');
                        for (let i = 0; i < results.length; i++) {
                            const result = results[i];
                            try {
                                const blob = new Blob([result.content], {
                                    type: outputFormat === 'html' ? 'text/html' : 'text/plain'
                                });
                                
                                console.log(`下载文件 ${i+1}/${results.length}: ${result.fileName}`);
                                
                                try {
                                    // 尝试使用 saveAs 函数
                                    saveAs(blob, result.fileName);
                                } catch (saveError) {
                                    // 备用下载方法
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = result.fileName;
                                    document.body.appendChild(a);
                                    a.click();
                                    setTimeout(() => {
                                        document.body.removeChild(a);
                                        URL.revokeObjectURL(url);
                                    }, 100);
                                }
                                
                                // 稍微延迟每个下载，避免浏览器阻塞
                                if (i < results.length - 1) {
                                    await new Promise(resolve => setTimeout(resolve, 300));
                                }
                            } catch (downloadError) {
                                console.error(`文件 ${result.fileName} 下载失败: ${downloadError.message}`);
                            }
                        }
                    }
                    
                    // 处理完成
                    console.log(`批量处理完成，共处理 ${results.length} 个文件`);
                    showNotification(`批量处理完成，共处理 ${results.length} 个文件`);
                } catch (error) {
                    console.error(`批量处理时发生错误: ${error.message}`);
                    showNotification(`批量处理时发生错误: ${error.message}`, 'error');
                }
            }
            
            // 处理单个文件
            function processFile(title, content, templateConfig, outputFormat) {
                try {
                    // 将Markdown转换为HTML
                    let htmlContent = marked.parse(content);
                    
                    // 应用顶部模板
                    let topContent = '';
                    if (templateConfig.templates.top.useTemplate && templateConfig.templates.top.templateContent) {
                        topContent = templateConfig.templates.top.templateContent;
                    }
                    
                    // 应用底部模板
                    let bottomContent = '';
                    if (templateConfig.templates.bottom.useTemplate && templateConfig.templates.bottom.templateContent) {
                        bottomContent = templateConfig.templates.bottom.templateContent;
                    }
                    
                    // 处理标题模板
                    if (templateConfig.headings.h2.useTemplate && templateConfig.headings.h2.templateContent) {
                        // 查找所有h2标签并替换为模板
                        const h2Regex = /<h2[^>]*>(.*?)<\/h2>/g;
                        htmlContent = htmlContent.replace(h2Regex, (match, text) => {
                            let template = templateConfig.headings.h2.templateContent;
                            return template.replace('{h2_text}', text);
                        });
                    }
                    
                    // 根据输出格式生成内容
                    switch (outputFormat) {
                        case 'html':
                            // 生成CSS
                            const css = generateCSSForTemplate(templateConfig);
                            
                            // 创建完整HTML
                            return `
                                <!DOCTYPE html>
                                <html>
                                <head>
                                    <meta charset="UTF-8">
                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                    <title>${title}</title>
                                    <style>
                                        ${css}
                                    </style>
                                </head>
                                <body>
                                    <div class="wechat-article">
                                        <div class="article-content">
                                            ${topContent}
                                            ${htmlContent}
                                            ${bottomContent}
                                        </div>
                                    </div>
                                </body>
                                </html>
                            `;
                        
                        case 'md':
                            // 返回原始Markdown内容
                            return `# ${title}\n\n${content}`;
                            
                        case 'txt':
                            // 生成CSS
                            const cssTxt = generateCSSForTemplate(templateConfig);
                            
                            // 创建完整HTML (保存为TXT格式)
                            return `
                                <!DOCTYPE html>
                                <html>
                                <head>
                                    <meta charset="UTF-8">
                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                    <title>${title}</title>
                                    <style>
                                        ${cssTxt}
                                    </style>
                                </head>
                                <body>
                                    <div class="wechat-article">
                                        <div class="article-content">
                                            ${topContent}
                                            ${htmlContent}
                                            ${bottomContent}
                                        </div>
                                    </div>
                                </body>
                                </html>
                            `;
                    }
                } catch (error) {
                    console.error(`处理文件内容时出错: ${error.message}`);
                    return null;
                }
            }
            
            // 为模板生成CSS
            function generateCSSForTemplate(templateConfig) {
                // 基础样式
                let css = `
                    .wechat-article {
                        font-family: ${templateConfig.global.font};
                        line-height: ${templateConfig.global.lineHeight};
                        letter-spacing: ${templateConfig.global.letterSpacing}em;
                        color: ${templateConfig.paragraph.color};
                        ${templateConfig.global.centerContent ? 'text-align: center;' : ''}
                    }
                    
                    .article-content {
                        margin: 0 auto;
                        max-width: 100%;
                        word-wrap: break-word;
                    }
                `;
                
                // 段落样式
                if (templateConfig.paragraph.colorMode === 'single') {
                    css += `
                        .article-content p {
                            font-size: ${templateConfig.paragraph.fontSize}px;
                            margin: ${templateConfig.paragraph.margin}em 0;
                            color: ${templateConfig.paragraph.color};
                        }
                    `;
                } else if (templateConfig.paragraph.colorMode === 'multiple' && templateConfig.paragraph.colors.length > 0) {
                    // 多色轮换模式
                    templateConfig.paragraph.colors.forEach((color, index) => {
                        css += `
                            .article-content p:nth-of-type(${templateConfig.paragraph.colors.length}n+${index+1}) {
                                font-size: ${templateConfig.paragraph.fontSize}px;
                                margin: ${templateConfig.paragraph.margin}em 0;
                                color: ${color};
                            }
                        `;
                    });
                } else if (templateConfig.paragraph.colorMode === 'random' && templateConfig.paragraph.randomColors.length > 0) {
                    // 随机颜色模式
                    templateConfig.paragraph.randomColors.forEach((color, index) => {
                        css += `
                            .article-content p:nth-of-type(${templateConfig.paragraph.randomColors.length}n+${index+1}) {
                                font-size: ${templateConfig.paragraph.fontSize}px;
                                margin: ${templateConfig.paragraph.margin}em 0;
                                color: ${color};
                            }
                        `;
                    });
                } else {
                    // 如果未设置颜色数组或模式，使用单色
                    css += `
                        .article-content p {
                            font-size: ${templateConfig.paragraph.fontSize}px;
                            margin: ${templateConfig.paragraph.margin}em 0;
                            color: ${templateConfig.paragraph.color};
                        }
                    `;
                }
                
                // 标题样式（如果没有使用模板）
                if (!templateConfig.headings.h1.useTemplate) {
                    css += `
                        .article-content h1 {
                            font-size: ${templateConfig.headings.h1.fontSize}px;
                            color: ${templateConfig.headings.h1.color}; 
                            background-color: ${templateConfig.headings.h1.bgColor};
                            padding: 10px;
                            ${templateConfig.headings.h1.border ? `border-bottom: 2px solid ${templateConfig.headings.h1.color};` : ''}
                            margin: 1.5em 0 1em;
                        }
                    `;
                }
                
                if (!templateConfig.headings.h2.useTemplate) {
                    css += `
                        .article-content h2 {
                            font-size: ${templateConfig.headings.h2.fontSize}px;
                            color: ${templateConfig.headings.h2.color}; 
                            border-left: 5px solid ${templateConfig.headings.h2.borderColor};
                            padding-left: 10px;
                            margin: 1.5em 0 1em;
                        }
                    `;
                }
                
                if (!templateConfig.headings.h3.useTemplate) {
                    css += `
                        .article-content h3 {
                            font-size: ${templateConfig.headings.h3.fontSize}px;
                            color: ${templateConfig.headings.h3.color}; 
                            margin: 1.2em 0.8em;
                        }
                    `;
                }
                
                // 强调样式 - 粗体
                if (templateConfig.emphasis.strong.colorMode === 'single') {
                    css += `
                        .article-content strong {
                            color: ${templateConfig.emphasis.strong.color};
                            background-color: ${templateConfig.emphasis.strong.bgColor};
                            padding: 0 2px;
                            ${templateConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                        }
                    `;
                } else if (templateConfig.emphasis.strong.colorMode === 'multiple' && templateConfig.emphasis.strong.colors.length > 0) {
                    // 多色轮换模式
                    templateConfig.emphasis.strong.colors.forEach((color, index) => {
                        css += `
                            .article-content strong:nth-of-type(${templateConfig.emphasis.strong.colors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${templateConfig.emphasis.strong.bgColor};
                                padding: 0 2px;
                                ${templateConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                            }
                        `;
                    });
                } else if (templateConfig.emphasis.strong.colorMode === 'random' && templateConfig.emphasis.strong.randomColors.length > 0) {
                    // 随机颜色模式
                    templateConfig.emphasis.strong.randomColors.forEach((color, index) => {
                        css += `
                            .article-content strong:nth-of-type(${templateConfig.emphasis.strong.randomColors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${templateConfig.emphasis.strong.bgColor};
                                padding: 0 2px;
                                ${templateConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                            }
                        `;
                    });
                } else {
                    // 未设置颜色数组或模式，使用单色
                    css += `
                        .article-content strong {
                            color: ${templateConfig.emphasis.strong.color};
                            background-color: ${templateConfig.emphasis.strong.bgColor};
                            padding: 0 2px;
                            ${templateConfig.emphasis.strong.underline ? 'text-decoration: underline;' : ''}
                        }
                    `;
                }
                
                // 强调样式 - 斜体
                if (templateConfig.emphasis.em.colorMode === 'single') {
                    css += `
                        .article-content em {
                            color: ${templateConfig.emphasis.em.color};
                            ${templateConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                        }
                    `;
                } else if (templateConfig.emphasis.em.colorMode === 'multiple' && templateConfig.emphasis.em.colors.length > 0) {
                    // 多色轮换模式
                    templateConfig.emphasis.em.colors.forEach((color, index) => {
                        css += `
                            .article-content em:nth-of-type(${templateConfig.emphasis.em.colors.length}n+${index+1}) {
                                color: ${color};
                                ${templateConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                            }
                        `;
                    });
                } else if (templateConfig.emphasis.em.colorMode === 'random' && templateConfig.emphasis.em.randomColors.length > 0) {
                    // 随机颜色模式
                    templateConfig.emphasis.em.randomColors.forEach((color, index) => {
                        css += `
                            .article-content em:nth-of-type(${templateConfig.emphasis.em.randomColors.length}n+${index+1}) {
                                color: ${color};
                                ${templateConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                            }
                        `;
                    });
                } else {
                    // 未设置颜色数组或模式，使用单色
                    css += `
                        .article-content em {
                            color: ${templateConfig.emphasis.em.color};
                            ${templateConfig.emphasis.em.keepItalic ? '' : 'font-style: normal;'}
                        }
                    `;
                }
                
                // 强调样式 - 引用
                if (templateConfig.emphasis.blockquote.colorMode === 'single') {
                    css += `
                        .article-content blockquote {
                            color: ${templateConfig.emphasis.blockquote.color};
                            background-color: ${templateConfig.emphasis.blockquote.bgColor};
                            border-left: 4px solid ${templateConfig.emphasis.blockquote.borderColor};
                            padding: 10px 15px;
                            margin: 1em 0;
                        }
                        
                        .article-content blockquote p {
                            color: ${templateConfig.emphasis.blockquote.color} !important;
                        }
                    `;
                } else if (templateConfig.emphasis.blockquote.colorMode === 'multiple' && templateConfig.emphasis.blockquote.colors.length > 0) {
                    // 多色轮换模式
                    templateConfig.emphasis.blockquote.colors.forEach((color, index) => {
                        css += `
                            .article-content blockquote:nth-of-type(${templateConfig.emphasis.blockquote.colors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${templateConfig.emphasis.blockquote.bgColor};
                                border-left: 4px solid ${templateConfig.emphasis.blockquote.borderColor};
                                padding: 10px 15px;
                                margin: 1em 0;
                            }
                            
                            .article-content blockquote:nth-of-type(${templateConfig.emphasis.blockquote.colors.length}n+${index+1}) p {
                                color: ${color} !important;
                            }
                        `;
                    });
                } else if (templateConfig.emphasis.blockquote.colorMode === 'random' && templateConfig.emphasis.blockquote.randomColors.length > 0) {
                    // 随机颜色模式
                    templateConfig.emphasis.blockquote.randomColors.forEach((color, index) => {
                        css += `
                            .article-content blockquote:nth-of-type(${templateConfig.emphasis.blockquote.randomColors.length}n+${index+1}) {
                                color: ${color};
                                background-color: ${templateConfig.emphasis.blockquote.bgColor};
                                border-left: 4px solid ${templateConfig.emphasis.blockquote.borderColor};
                                padding: 10px 15px;
                                margin: 1em 0;
                            }
                            
                            .article-content blockquote:nth-of-type(${templateConfig.emphasis.blockquote.randomColors.length}n+${index+1}) p {
                                color: ${color} !important;
                            }
                        `;
                    });
                } else {
                    // 未设置颜色数组或模式，使用单色
                    css += `
                        .article-content blockquote {
                            color: ${templateConfig.emphasis.blockquote.color};
                            background-color: ${templateConfig.emphasis.blockquote.bgColor};
                            border-left: 4px solid ${templateConfig.emphasis.blockquote.borderColor};
                            padding: 10px 15px;
                            margin: 1em 0;
                        }
                        
                        .article-content blockquote p {
                            color: ${templateConfig.emphasis.blockquote.color} !important;
                        }
                    `;
                }
                
                // 列表样式
                let listItemStyle = `
                    .article-content li {
                `;
                
                if (templateConfig.emphasis.list.colorMode === 'single') {
                    listItemStyle += `color: ${templateConfig.emphasis.list.color};`;
                }
                
                if (templateConfig.emphasis.list.bold) {
                    listItemStyle += `font-weight: bold;`;
                }
                
                listItemStyle += `}`;
                css += listItemStyle;
                
                // 列表多色模式
                if (templateConfig.emphasis.list.colorMode === 'multiple' && templateConfig.emphasis.list.colors.length > 0) {
                    // 多色轮换模式
                    templateConfig.emphasis.list.colors.forEach((color, index) => {
                        css += `
                            .article-content li:nth-of-type(${templateConfig.emphasis.list.colors.length}n+${index+1}) {
                                color: ${color};
                                ${templateConfig.emphasis.list.bold ? 'font-weight: bold;' : ''}
                            }
                        `;
                    });
                } else if (templateConfig.emphasis.list.colorMode === 'random' && templateConfig.emphasis.list.randomColors.length > 0) {
                    // 随机颜色模式
                    templateConfig.emphasis.list.randomColors.forEach((color, index) => {
                        css += `
                            .article-content li:nth-of-type(${templateConfig.emphasis.list.randomColors.length}n+${index+1}) {
                                color: ${color};
                                ${templateConfig.emphasis.list.bold ? 'font-weight: bold;' : ''}
                            }
                        `;
                    });
                }
                
                // 列表marker颜色 (项目符号和数字)
                css += `
                    .article-content ul li::marker,
                    .article-content ol li::marker {
                        color: ${templateConfig.emphasis.list.markerColor};
                    }
                `;
                
                // 其他样式
                css += `
                    .article-content code {
                        color: ${templateConfig.code.inlineColor};
                        background-color: ${templateConfig.code.inlineBgColor};
                        padding: 2px 4px;
                        border-radius: 3px;
                        font-family: Consolas, Monaco, 'Courier New', monospace;
                        font-size: 0.9em;
                    }
                    
                    .article-content pre {
                        margin: 1em 0;
                        padding: 0;
                        overflow: auto;
                    }
                    
                    .article-content pre > code {
                        display: block;
                        padding: 10px;
                        color: inherit;
                        background-color: #282c34;
                        border-radius: 5px;
                        overflow-x: auto;
                    }
                    
                    .article-content a {
                        color: ${templateConfig.other.linkColor};
                        text-decoration: none;
                        border-bottom: 1px solid ${templateConfig.other.linkColor};
                    }
                    
                    .article-content hr {
                        border: none;
                        border-top: 1px ${templateConfig.other.hrStyle} ${templateConfig.other.hrColor};
                        margin: 2em 0;
                    }
                    
                    .article-content img {
                        max-width: 100%;
                        height: auto;
                        display: block;
                        margin: 1em auto;
                        border-radius: 5px;
                    }
                    
                    .article-content table {
                        border-collapse: collapse;
                        width: 100%;
                        margin: 1em 0;
                    }
                    
                    .article-content th, .article-content td {
                        border: 1px solid #ddd;
                        padding: 8px;
                        text-align: left;
                    }
                    
                    .article-content th {
                        background-color: #f5f5f5;
                    }
                    
                    .article-content ul, .article-content ol {
                        padding-left: 2em;
                        margin: 1em 0;
                    }
                `;
                
                return css;
            }
            
            // 预设一些随机颜色
            styleConfig.paragraph.randomColors = ["#e74c3c", "#3498db", "#2ecc71"];
            styleConfig.emphasis.strong.randomColors = ["#e74c3c", "#3498db", "#2ecc71"];
            styleConfig.emphasis.em.randomColors = ["#9b59b6", "#f39c12", "#e74c3c"];
            
            // 预设底部模板
            styleConfig.templates.bottom.useTemplate = true;
            styleConfig.templates.bottom.templateContent = "点分享<br>点收藏<br>点在看<br>点点赞";
            styleConfig.templates.bottom.templateName = "标准底部";
            document.getElementById('bottom-template-info').classList.remove('hidden');
            document.getElementById('bottom-template-name').textContent = "标准底部";
            document.getElementById('bottom-template-preview').classList.remove('hidden');
            document.getElementById('bottom-template-preview').innerHTML = styleConfig.templates.bottom.templateContent;
            
            // 添加示例内容
            articleTitle.value = "微信公众号文章排版工具使用指南";
            articleContent.value = `
# 微信公众号文章排版工具

这是一个强大的**微信公众号文章排版工具**，集成了多种功能，让你的公众号文章排版更加美观、专业。

## 主要功能

1. **自定义CSS样式**：可以自定义文章标题、正文、引用等多种元素的样式
2. **Markdown支持**：使用Markdown语法快速编写格式化文本
3. **批量处理**：一次性处理多个文件，提高工作效率
4. **模板管理**：保存和加载样式模板，方便复用
5. **实时预览**：所见即所得，实时查看排版效果

## 使用方法

### 1. 编辑内容

在左侧编辑区域输入Markdown格式的文章内容，或者导入Markdown文件。

> 支持标准Markdown语法，包括标题、列表、引用、链接、图片等。

### 2. 样式设置

在样式设置面板中可以自定义:

* 全局设置（字体、行间距等）
* 段落样式（支持多色轮换）
* 标题样式（H1-H3，支持自定义模板）
* 强调样式（粗体、斜体、引用，支持多色轮换）
* 代码样式
* 其他元素样式

### 3. 模板管理

可以将当前样式保存为模板，方便下次使用。也可以加载已保存的模板。

### 4. 批量处理

支持批量处理文件夹中的所有Markdown文件，或选择多个文件进行处理。

---

## 代码示例

\`\`\`javascript
// 一个简单的JavaScript代码示例
function formatArticle(content, style) {
    const formatted = applyStyle(content, style);
    return formatted;
}

// 调用函数
const result = formatArticle(articleContent, myStyle);
console.log("格式化完成!");
\`\`\`

## 表格示例

| 功能 | 描述 | 支持情况 |
|------|------|--------|
| Markdown | 支持Markdown语法 | ✅ |
| 自定义样式 | 自定义CSS样式 | ✅ |
| 批量处理 | 批量处理多个文件 | ✅ |
| 模板管理 | 保存和加载样式模板 | ✅ |

*希望这个工具能够帮助你提高工作效率，创作出更加精美的公众号文章!*
`;
            updateWordCount();
            updatePreview();
        });
    </script>

    <!-- =========  何武昂工作室 • 激活码验证系统  ========= -->
    <!-- 依赖 -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- 激活码验证遮罩层 -->
    <style>
        #license-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(10,18,30,0.92);color:#fff;display:none;align-items:center;justify-content:center;z-index:2147483647;font-family:'Poppins',-apple-system,BlinkMacSystemFont,'Segoe UI','PingFang SC','Microsoft YaHei',sans-serif;backdrop-filter:blur(6px)}
        #license-overlay .panel{background:#1e1e2f;padding:40px 35px;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,0.4);width:92%;max-width:420px;text-align:center}
        #license-overlay h2{margin:0 0 20px;font-size:28px;letter-spacing:1px;font-weight:600;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;background-clip:text;color:transparent}
        #license-overlay p{margin:0 0 18px;font-size:14px;line-height:1.6;color:#d1d5db}
        #license-overlay .machine{background:#111827;padding:10px;border-radius:6px;font-weight:600;user-select:all;margin-bottom:20px;word-break:break-all;font-size:15px}
        #license-overlay input{width:100%;padding:12px;border-radius:6px;border:none;font-size:16px;text-align:center;margin-bottom:20px;background:#374151;color:#f9fafb}
        #license-overlay button{width:100%;padding:12px;border:none;border-radius:6px;background:#2563eb;color:#fff;font-size:16px;cursor:pointer;transition:all .3s ease}
        #license-overlay button:hover{background:#1d4ed8;transform:translateY(-2px)}
        #license-overlay .footer{margin-top:24px;font-size:12px;color:#9ca3af}
    </style>
    <div id="license-overlay">
        <div class="panel">
            <h2>HeWuAng&nbsp;Studio</h2>
            <p>本工具采用一机一码激活机制，请将以下机器码发送给管理员获取激活码</p>
            <div class="machine" id="machine-id">XXXX-XXXX-XXXX-XXXX</div>
            <input id="activation-input" placeholder="在此输入激活码" />
            <button id="activate-btn">立即激活</button>
            <div class="footer">管理员微信: h421094218<br/>© 2024 何武昂工作室出品</div>
        </div>
    </div>

    <!-- 激活脚本 -->
    <script>
        (function(){
            const secretSalt = 'HeWuAngStudio2024!';
            // 生成/获取机器码（本地存储保存，保证一机一码）
            function getMachineId(){
                return window.HWA_MACHINE_ID || localStorage.getItem('HWA_MACHINE_ID') || 'UNKNOWN';
            }
            // 根据机器码和盐生成激活码：格式  XXXX-XXXX-XXXX-XXXX-<days>
            function generateCode(mid, days){
                const hash = CryptoJS.SHA256(mid + secretSalt + days).toString().toUpperCase();
                return hash.substr(0,16).match(/.{1,4}/g).join('-') + '-' + days;
            }
            // 从激活码解析有效期（天）
            function getDays(code){
                const arr = (code||'').trim().toUpperCase().split('-');
                if(arr.length < 5) return null;
                const d = parseInt(arr[arr.length-1]);
                return isNaN(d) ? null : d;
            }
            // 校验激活码
            function isValid(code){
                const days = getDays(code);
                if(!days) return false;
                const hashPart = code.trim().toUpperCase().split('-').slice(0,4).join('');
                const expected = CryptoJS.SHA256(getMachineId() + secretSalt + days).toString().toUpperCase().substr(0,16);
                return hashPart === expected;
            }

            // DOM Ready
            document.addEventListener('DOMContentLoaded',()=>{
                const overlay = document.getElementById('license-overlay');
                const machineSpan = document.getElementById('machine-id');
                const input = document.getElementById('activation-input');
                const btn = document.getElementById('activate-btn');

                const storedCode = localStorage.getItem('HWA_ACT_CODE');
                const storedDays = parseInt(localStorage.getItem('HWA_ACT_DAYS')||0);
                const activated = storedCode && isValid(storedCode);

                if(activated){
                    // 若未记录激活时间，补录当前时间
                    if(!localStorage.getItem('HWA_ACT_TS')){
                        localStorage.setItem('HWA_ACT_TS', Date.now());
                    }
                    overlay.style.display = 'none';
                    showLicenseInfo();
                }else{
                    overlay.style.display = 'flex';
                    machineSpan.textContent = getMachineId();
                }

                btn && btn.addEventListener('click',()=>{
                    const code = input.value.trim().toUpperCase();
                    if(isValid(code)){
                        const days = getDays(code) || 365;
                        localStorage.setItem('HWA_ACT_CODE', code);
                        localStorage.setItem('HWA_ACT_DAYS', days);
                        localStorage.setItem('HWA_ACT_TS', Date.now());
                        alert('🎉 激活成功! 感谢您的支持');
                        overlay.style.display='none';
                        showLicenseInfo();
                    }else{
                        alert('❌ 激活码无效，请检查后重试');
                    }
                });
            });

            // 向外暴露生成器所需的辅助函数(仅调试使用)
            window._HWA_LICENSE = {getMachineId, generateCode};
        })();
    </script>
    <!-- =========  激活系统结束  ========= -->

    <!-- 版权信息 -->
    <footer style="text-align:center;font-size:12px;color:#9ca3af;margin:40px 0 20px;">© 2024 何武昂工作室出品 | 管理员微信 h421094218</footer>

    <!-- 显示激活剩余时间脚本（独立） -->
    <script>
      function showLicenseInfo(){
        try{
          let bar=document.getElementById('license-info');
          if(!bar){
            bar=document.createElement('div');
            bar.id='license-info';
            bar.style.cssText='position:fixed;bottom:15px;right:15px;padding:8px 14px;background:rgba(17,24,39,.85);color:#f1f5f9;font-size:13px;border-radius:8px;backdrop-filter:blur(4px);z-index:2147483647;user-select:none';
            document.body.appendChild(bar);
          }
          const DAYS=parseInt(localStorage.getItem("HWA_ACT_DAYS")||365);
          const ts=parseInt(localStorage.getItem("HWA_ACT_TS")||Date.now());
          function update(){
            const remain=ts+DAYS*86400000-Date.now();
            if(remain<=0){
              bar.textContent='激活已到期，请联系管理员续期';
              bar.style.background='rgba(185,28,28,.9)';
              return;
            }
            const d=Math.floor(remain/86400000);
            const h=Math.floor((remain%86400000)/3600000);
            bar.textContent=`激活剩余: ${d}天 ${h}小时`;
          }
          update();
          setInterval(update,60000);
        }catch(e){console.error(e)}
      }
    </script>

    <script>
    document.addEventListener('keydown',function(e){
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){
         e.preventDefault();            // 阻止默认保存
         e.stopPropagation();
         alert('已禁用页面保存功能');
      }
    });
    </script>
</body></html>
